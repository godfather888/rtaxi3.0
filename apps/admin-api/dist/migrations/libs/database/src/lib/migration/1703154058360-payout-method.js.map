{"version":3,"sources":["../../../../../../../../../libs/database/src/lib/migration/1703154058360-payout-method.ts"],"sourcesContent":["import {\n  MigrationInterface,\n  QueryRunner,\n  TableColumn,\n  TableForeignKey,\n} from 'typeorm';\nimport { Table } from 'typeorm/schema-builder/table/Table';\nexport enum PayoutMethodType {\n  Stripe = 'stripe',\n  BankTransfer = 'bank_transfer',\n}\nexport enum SavedPaymentMethodType {\n  CARD = 'CARD',\n  BANK_ACCOUNT = 'BANK_ACCOUNT',\n}\nexport class PayoutMethodEntityMigration1627567460081\n  implements MigrationInterface\n{\n  public async up(queryRunner: QueryRunner): Promise<void> {\n    try {\n      await queryRunner.query('DELETE FROM `payout_account` WHERE id > 0');\n      await queryRunner.createTable(\n        new Table({\n          name: 'payout_method',\n          columns: [\n            {\n              name: 'id',\n              type: 'int',\n              isPrimary: true,\n              isGenerated: true,\n              generationStrategy: 'increment',\n            },\n            {\n              name: 'enabled',\n              type: 'boolean',\n              default: true,\n            },\n            {\n              name: 'name',\n              type: 'varchar',\n            },\n            {\n              name: 'description',\n              type: 'varchar',\n              isNullable: true,\n            },\n            {\n              name: 'type',\n              type: 'enum',\n              enum: Object.values(PayoutMethodType),\n            },\n            {\n              name: 'publicKey',\n              type: 'text',\n              isNullable: true,\n            },\n            {\n              name: 'privateKey',\n              type: 'text',\n              isNullable: true,\n            },\n            {\n              name: 'saltKey',\n              type: 'text',\n              isNullable: true,\n            },\n            {\n              name: 'merchantId',\n              type: 'text',\n              isNullable: true,\n            },\n            {\n              name: 'deletedAt',\n              type: 'timestamp',\n              isNullable: true,\n            },\n            {\n              name: 'mediaId',\n              type: 'int',\n              isNullable: true,\n            },\n          ],\n          foreignKeys: [\n            {\n              name: 'fk_payout_method_media',\n              columnNames: ['mediaId'],\n              referencedTableName: 'media',\n              referencedColumnNames: ['id'],\n              onDelete: 'SET NULL',\n              onUpdate: 'NO ACTION',\n            },\n          ],\n        }),\n        true,\n      );\n    } catch (error) {\n      console.error(error);\n    }\n    try {\n      await queryRunner.addColumn(\n        'payout_account',\n        new TableColumn({\n          name: 'payoutMethodId',\n          type: 'int',\n          isNullable: true,\n        }),\n      );\n      await queryRunner.createForeignKey(\n        'payout_account',\n        new TableForeignKey({\n          name: 'fk_payout_account_payout_method',\n          columnNames: ['payoutMethodId'],\n          referencedTableName: 'payout_method',\n          referencedColumnNames: ['id'],\n          onDelete: 'SET NULL',\n          onUpdate: 'NO ACTION',\n        }),\n      );\n      await queryRunner.addColumn(\n        'payout_account',\n        new TableColumn({\n          name: 'type',\n          type: 'enum',\n          enum: Object.values(SavedPaymentMethodType),\n        }),\n      );\n      await queryRunner.addColumn(\n        'payout_account',\n        new TableColumn({\n          name: 'last4',\n          type: 'varchar',\n        }),\n      );\n      await queryRunner.addColumn(\n        'payout_account',\n        new TableColumn({\n          name: 'currency',\n          type: 'varchar',\n        }),\n      );\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  public async down(queryRunner: QueryRunner): Promise<void> {\n    try {\n      await queryRunner.dropTable('payout_method');\n      await queryRunner.dropForeignKey(\n        'payout_account',\n        'fk_payout_account_payout_method',\n      );\n      await queryRunner.dropColumn('payout_account', 'payoutMethodId');\n      await queryRunner.dropColumn('payout_account', 'type');\n      await queryRunner.dropColumn('payout_account', 'last4');\n      await queryRunner.dropColumn('payout_account', 'currency');\n    } catch (error) {\n      console.error(error);\n    }\n  }\n}\n"],"names":["PayoutMethodEntityMigration1627567460081","PayoutMethodType","SavedPaymentMethodType","up","queryRunner","query","createTable","Table","name","columns","type","isPrimary","isGenerated","generationStrategy","default","isNullable","enum","Object","values","foreignKeys","columnNames","referencedTableName","referencedColumnNames","onDelete","onUpdate","error","console","addColumn","TableColumn","createForeignKey","TableForeignKey","down","dropTable","dropForeignKey","dropColumn"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;;;;;;;;IAeaA,wCAAwC;eAAxCA;;;;;;;;;yBAVN;uBACe;;UACVC;;;GAAAA,qBAAAA;;UAIAC;;;GAAAA,2BAAAA;AAIL,IAAA,AAAMF,2CAAN,MAAMA;IAGX,MAAaG,GAAGC,WAAwB,EAAiB;QACvD,IAAI;YACF,MAAMA,YAAYC,KAAK,CAAC;YACxB,MAAMD,YAAYE,WAAW,CAC3B,IAAIC,YAAK,CAAC;gBACRC,MAAM;gBACNC,SAAS;oBACP;wBACED,MAAM;wBACNE,MAAM;wBACNC,WAAW;wBACXC,aAAa;wBACbC,oBAAoB;oBACtB;oBACA;wBACEL,MAAM;wBACNE,MAAM;wBACNI,SAAS;oBACX;oBACA;wBACEN,MAAM;wBACNE,MAAM;oBACR;oBACA;wBACEF,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;oBACA;wBACEP,MAAM;wBACNE,MAAM;wBACNM,MAAMC,OAAOC,MAAM,CAACjB;oBACtB;oBACA;wBACEO,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;oBACA;wBACEP,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;oBACA;wBACEP,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;oBACA;wBACEP,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;oBACA;wBACEP,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;oBACA;wBACEP,MAAM;wBACNE,MAAM;wBACNK,YAAY;oBACd;iBACD;gBACDI,aAAa;oBACX;wBACEX,MAAM;wBACNY,aAAa;4BAAC;yBAAU;wBACxBC,qBAAqB;wBACrBC,uBAAuB;4BAAC;yBAAK;wBAC7BC,UAAU;wBACVC,UAAU;oBACZ;iBACD;YACH,IACA;QAEJ,EAAE,OAAOC,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;QACA,IAAI;YACF,MAAMrB,YAAYuB,SAAS,CACzB,kBACA,IAAIC,oBAAW,CAAC;gBACdpB,MAAM;gBACNE,MAAM;gBACNK,YAAY;YACd;YAEF,MAAMX,YAAYyB,gBAAgB,CAChC,kBACA,IAAIC,wBAAe,CAAC;gBAClBtB,MAAM;gBACNY,aAAa;oBAAC;iBAAiB;gBAC/BC,qBAAqB;gBACrBC,uBAAuB;oBAAC;iBAAK;gBAC7BC,UAAU;gBACVC,UAAU;YACZ;YAEF,MAAMpB,YAAYuB,SAAS,CACzB,kBACA,IAAIC,oBAAW,CAAC;gBACdpB,MAAM;gBACNE,MAAM;gBACNM,MAAMC,OAAOC,MAAM,CAAChB;YACtB;YAEF,MAAME,YAAYuB,SAAS,CACzB,kBACA,IAAIC,oBAAW,CAAC;gBACdpB,MAAM;gBACNE,MAAM;YACR;YAEF,MAAMN,YAAYuB,SAAS,CACzB,kBACA,IAAIC,oBAAW,CAAC;gBACdpB,MAAM;gBACNE,MAAM;YACR;QAEJ,EAAE,OAAOe,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;IACF;IAEA,MAAaM,KAAK3B,WAAwB,EAAiB;QACzD,IAAI;YACF,MAAMA,YAAY4B,SAAS,CAAC;YAC5B,MAAM5B,YAAY6B,cAAc,CAC9B,kBACA;YAEF,MAAM7B,YAAY8B,UAAU,CAAC,kBAAkB;YAC/C,MAAM9B,YAAY8B,UAAU,CAAC,kBAAkB;YAC/C,MAAM9B,YAAY8B,UAAU,CAAC,kBAAkB;YAC/C,MAAM9B,YAAY8B,UAAU,CAAC,kBAAkB;QACjD,EAAE,OAAOT,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;IACF;AACF"}