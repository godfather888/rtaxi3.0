{"version":3,"sources":["../../../../../../../../../libs/database/src/lib/migration/1703444461480-payout-session.ts"],"sourcesContent":["import {\n  MigrationInterface,\n  QueryRunner,\n  Table,\n  TableColumn,\n  TableForeignKey,\n  TableIndex,\n} from 'typeorm';\nexport enum PayoutSessionStatus {\n  PENDING = 'pending',\n  IN_PROGRESS = 'in_progress',\n  PAID = 'paid',\n  FAILED = 'failed',\n  CANCELLED = 'cancelled',\n}\nexport class PayoutSession1703444461480 implements MigrationInterface {\n  public async up(queryRunner: QueryRunner): Promise<void> {\n    try {\n      await queryRunner.createTable(\n        new Table({\n          name: 'payout_session',\n          columns: [\n            {\n              name: 'id',\n              type: 'int',\n              isPrimary: true,\n              isGenerated: true,\n              generationStrategy: 'increment',\n            },\n            {\n              name: 'createdAt',\n              type: 'datetime',\n              default: 'NOW()',\n            },\n            {\n              name: 'processedAt',\n              type: 'datetime',\n              isNullable: true,\n            },\n            {\n              name: 'description',\n              type: 'varchar',\n              isNullable: true,\n            },\n            {\n              name: 'status',\n              type: 'enum',\n              enum: Object.values(PayoutSessionStatus),\n              default: \"'pending'\",\n            },\n            {\n              name: 'totalAmount',\n              type: 'float',\n              default: 0,\n              precision: 10,\n              scale: 2,\n            },\n            {\n              name: 'currency',\n              type: 'varchar',\n            },\n            {\n              name: 'createdByOperatorId',\n              type: 'int',\n            },\n          ],\n          foreignKeys: [\n            {\n              columnNames: ['createdByOperatorId'],\n              referencedTableName: 'operator',\n              referencedColumnNames: ['id'],\n              onDelete: 'CASCADE',\n            },\n          ],\n          indices: [\n            {\n              columnNames: ['createdByOperatorId'],\n            },\n          ],\n        }),\n        true,\n        true,\n        true,\n      );\n    } catch (error) {\n      console.error('Error creating payout_session table:', error);\n    }\n    try {\n      await queryRunner.createTable(\n        new Table({\n          name: 'payout_session_payout_methods_payout_method',\n          columns: [\n            {\n              name: 'payoutSessionId',\n              type: 'int',\n            },\n            {\n              name: 'payoutMethodId',\n              type: 'int',\n            },\n          ],\n          foreignKeys: [\n            {\n              columnNames: ['payoutSessionId'],\n              referencedTableName: 'payout_session',\n              referencedColumnNames: ['id'],\n              onDelete: 'CASCADE',\n            },\n            {\n              columnNames: ['payoutMethodId'],\n              referencedTableName: 'payout_method',\n              referencedColumnNames: ['id'],\n              onDelete: 'CASCADE',\n            },\n          ],\n          indices: [\n            {\n              columnNames: ['payoutSessionId'],\n            },\n            {\n              columnNames: ['payoutMethodId'],\n            },\n          ],\n        }),\n      );\n    } catch (error) {\n      console.error(error);\n    }\n    try {\n      await queryRunner.addColumn(\n        'driver_transaction',\n        new TableColumn({\n          name: 'payoutSessionId',\n          type: 'int',\n          isNullable: true,\n        }),\n      );\n      await queryRunner.addColumn(\n        'driver_transaction',\n        new TableColumn({\n          name: 'payoutAccountId',\n          type: 'int',\n          isNullable: true,\n        }),\n      );\n      await queryRunner.addColumn(\n        'driver_transaction',\n        new TableColumn({\n          name: 'payoutMethodId',\n          type: 'int',\n          isNullable: true,\n        }),\n      );\n      await queryRunner.createForeignKey(\n        'driver_transaction',\n        new TableForeignKey({\n          columnNames: ['payoutSessionId'],\n          referencedTableName: 'payout_session',\n          referencedColumnNames: ['id'],\n          onDelete: 'CASCADE',\n        }),\n      );\n      await queryRunner.createForeignKey(\n        'driver_transaction',\n        new TableForeignKey({\n          columnNames: ['payoutAccountId'],\n          referencedTableName: 'payout_account',\n          referencedColumnNames: ['id'],\n          onDelete: 'CASCADE',\n        }),\n      );\n      await queryRunner.createForeignKey(\n        'driver_transaction',\n        new TableForeignKey({\n          columnNames: ['payoutMethodId'],\n          referencedTableName: 'payout_method',\n          referencedColumnNames: ['id'],\n          onDelete: 'CASCADE',\n        }),\n      );\n      await queryRunner.createIndex(\n        'driver_transaction',\n        new TableIndex({\n          columnNames: ['payoutSessionId'],\n        }),\n      );\n      await queryRunner.createIndex(\n        'driver_transaction',\n        new TableIndex({\n          columnNames: ['payoutAccountId'],\n        }),\n      );\n      await queryRunner.createIndex(\n        'driver_transaction',\n        new TableIndex({\n          columnNames: ['payoutMethodId'],\n        }),\n      );\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  public async down(queryRunner: QueryRunner): Promise<void> {\n    try {\n      await queryRunner.dropTable('payout_session');\n    } catch (error) {\n      console.error(error);\n    }\n  }\n}\n"],"names":["PayoutSession1703444461480","PayoutSessionStatus","up","queryRunner","createTable","Table","name","columns","type","isPrimary","isGenerated","generationStrategy","default","isNullable","enum","Object","values","precision","scale","foreignKeys","columnNames","referencedTableName","referencedColumnNames","onDelete","indices","error","console","addColumn","TableColumn","createForeignKey","TableForeignKey","createIndex","TableIndex","down","dropTable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}