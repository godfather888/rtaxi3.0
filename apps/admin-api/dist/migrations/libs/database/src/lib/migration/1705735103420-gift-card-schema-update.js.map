{"version":3,"sources":["../../../../../../../../../libs/database/src/lib/migration/1705735103420-gift-card-schema-update.ts"],"sourcesContent":["import {\n  MigrationInterface,\n  QueryRunner,\n  TableColumn,\n  TableForeignKey,\n  TableIndex,\n} from 'typeorm';\n\nexport class GiftCardSchemaUpdate1705735103420 implements MigrationInterface {\n  public async up(queryRunner: QueryRunner): Promise<void> {\n    try {\n      await queryRunner.renameTable('gift_card', 'gift_code');\n    } catch (error) {\n      console.error(error);\n    }\n    try {\n      await queryRunner.addColumns('gift', [\n        new TableColumn({\n          name: 'name',\n          type: 'varchar',\n        }),\n        new TableColumn({\n          name: 'createdByOperatorId',\n          type: 'int',\n        }),\n        new TableColumn({\n          name: 'createdAt',\n          type: 'datetime',\n          default: 'NOW()',\n        }),\n      ]);\n    } catch (error) {\n      console.error(error);\n    }\n    try {\n      await queryRunner.createForeignKey(\n        'gift',\n        new TableForeignKey({\n          columnNames: ['createdByOperatorId'],\n          referencedColumnNames: ['id'],\n          referencedTableName: 'operator',\n          onDelete: 'SET NULL',\n        }),\n      );\n      await queryRunner.createIndex(\n        'gift',\n        new TableIndex({\n          columnNames: ['createdByOperatorId'],\n        }),\n      );\n    } catch (error) {\n      console.error(error);\n    }\n    try {\n      await queryRunner.dropColumns('gift_code', [\n        'amount',\n        'currency',\n        'availableTimestamp',\n        'expirationTimestamp',\n        'isUsed',\n      ]);\n      await queryRunner.addColumns('gift_code', [\n        new TableColumn({\n          name: 'usedAt',\n          type: 'datetime',\n          isNullable: true,\n        }),\n        new TableColumn({\n          name: 'giftId',\n          type: 'int',\n        }),\n      ]);\n      await queryRunner.createForeignKey(\n        'gift_code',\n        new TableForeignKey({\n          columnNames: ['giftId'],\n          referencedColumnNames: ['id'],\n          referencedTableName: 'gift',\n          onDelete: 'CASCADE',\n        }),\n      );\n      await queryRunner.createIndex(\n        'gift_code',\n        new TableIndex({\n          columnNames: ['giftId'],\n        }),\n      );\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  public async down(queryRunner: QueryRunner): Promise<void> {}\n}\n"],"names":["GiftCardSchemaUpdate1705735103420","up","queryRunner","renameTable","error","console","addColumns","TableColumn","name","type","default","createForeignKey","TableForeignKey","columnNames","referencedColumnNames","referencedTableName","onDelete","createIndex","TableIndex","dropColumns","isNullable","down"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAQaA;;;eAAAA;;;yBAFN;AAEA,IAAA,AAAMA,oCAAN,MAAMA;IACX,MAAaC,GAAGC,WAAwB,EAAiB;QACvD,IAAI;YACF,MAAMA,YAAYC,WAAW,CAAC,aAAa;QAC7C,EAAE,OAAOC,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;QACA,IAAI;YACF,MAAMF,YAAYI,UAAU,CAAC,QAAQ;gBACnC,IAAIC,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;gBACR;gBACA,IAAIF,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;gBACR;gBACA,IAAIF,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;oBACNC,SAAS;gBACX;aACD;QACH,EAAE,OAAON,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;QACA,IAAI;YACF,MAAMF,YAAYS,gBAAgB,CAChC,QACA,IAAIC,wBAAe,CAAC;gBAClBC,aAAa;oBAAC;iBAAsB;gBACpCC,uBAAuB;oBAAC;iBAAK;gBAC7BC,qBAAqB;gBACrBC,UAAU;YACZ;YAEF,MAAMd,YAAYe,WAAW,CAC3B,QACA,IAAIC,mBAAU,CAAC;gBACbL,aAAa;oBAAC;iBAAsB;YACtC;QAEJ,EAAE,OAAOT,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;QACA,IAAI;YACF,MAAMF,YAAYiB,WAAW,CAAC,aAAa;gBACzC;gBACA;gBACA;gBACA;gBACA;aACD;YACD,MAAMjB,YAAYI,UAAU,CAAC,aAAa;gBACxC,IAAIC,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;oBACNW,YAAY;gBACd;gBACA,IAAIb,oBAAW,CAAC;oBACdC,MAAM;oBACNC,MAAM;gBACR;aACD;YACD,MAAMP,YAAYS,gBAAgB,CAChC,aACA,IAAIC,wBAAe,CAAC;gBAClBC,aAAa;oBAAC;iBAAS;gBACvBC,uBAAuB;oBAAC;iBAAK;gBAC7BC,qBAAqB;gBACrBC,UAAU;YACZ;YAEF,MAAMd,YAAYe,WAAW,CAC3B,aACA,IAAIC,mBAAU,CAAC;gBACbL,aAAa;oBAAC;iBAAS;YACzB;QAEJ,EAAE,OAAOT,OAAO;YACdC,QAAQD,KAAK,CAACA;QAChB;IACF;IAEA,MAAaiB,KAAKnB,WAAwB,EAAiB,CAAC;AAC9D"}