"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[737],{5737:(U,P,r)=>{r.r(P),r.d(P,{ManagementPaymentGatewaysModule:()=>ie});var h=r(8434),b=r(7624),T=r(467),g=r(9417),s=r(3241),z=r(8204),_=r(1985),i=r(4843),c=r(9996),e=r(1360),l=r(2209),m=r(712),y=r(7094),u=r(6501),d=r(3039),v=r(1011),K=r(513),w=r(6389),C=r(5930),R=r(1951),Y=r(7529),j=r(8927),k=r(1997),I=r(3062),A=r(2358),E=r(7481),S=r(8018);const V=n=>({Authorization:n});function L(n,p){if(1&n){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.onDelete())}),e.nrm(1,"i",21),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&n&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"profile.delete")," "))}function B(n,p){if(1&n&&e.nrm(0,"nz-option",22),2&n){const t=p.$implicit;e.Y8G("nzValue",t)("nzLabel",t)}}function N(n,p){if(1&n&&(e.j41(0,"nz-form-item")(1,"nz-form-label",23),e.EFF(2),e.k0s(),e.j41(3,"nz-form-control"),e.nrm(4,"input",24),e.k0s()()),2&n){const t=e.XpG().ngIf;e.R7$(2),e.JRh(t.publicKey)}}function X(n,p){if(1&n&&(e.j41(0,"nz-form-item")(1,"nz-form-label",25),e.EFF(2),e.k0s(),e.j41(3,"nz-form-control"),e.nrm(4,"input",26),e.k0s()()),2&n){const t=e.XpG().ngIf;e.R7$(2),e.JRh(t.privateKey)}}function x(n,p){if(1&n&&(e.j41(0,"nz-form-item")(1,"nz-form-label",27),e.EFF(2),e.k0s(),e.j41(3,"nz-form-control"),e.nrm(4,"input",28),e.k0s()()),2&n){const t=e.XpG().ngIf;e.R7$(2),e.JRh(t.merchantId)}}function Q(n,p){if(1&n&&(e.j41(0,"nz-form-item")(1,"nz-form-label",29),e.EFF(2),e.k0s(),e.j41(3,"nz-form-control"),e.nrm(4,"input",30),e.k0s()()),2&n){const t=e.XpG().ngIf;e.R7$(2),e.JRh(t.saltKey)}}function J(n,p){if(1&n&&(e.j41(0,"div",5),e.DNE(1,N,5,1,"nz-form-item",17)(2,X,5,1,"nz-form-item",17)(3,x,5,1,"nz-form-item",17)(4,Q,5,1,"nz-form-item",17),e.k0s()),2&n){const t=p.ngIf;e.R7$(),e.Y8G("ngIf",null!=t.publicKey),e.R7$(),e.Y8G("ngIf",null!=t.privateKey),e.R7$(),e.Y8G("ngIf",null!=t.merchantId),e.R7$(),e.Y8G("ngIf",null!=t.saltKey)}}function H(n,p){if(1&n&&(e.qex(0),e.nrm(1,"i",31),e.j41(2,"div",32),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("nzType",t.loadingUpload?"loading":"plus"),e.R7$(2),e.JRh(e.bMT(4,2,"profile.upload"))}}function W(n,p){if(1&n&&e.nrm(0,"img",33),2&n){const t=e.XpG();e.Y8G("src",t.avatarUrl,e.B4B)}}let $=(()=>{class n{route;fb;updateGQL;createGQL;routerHelper;msg;modal;apollo;form;subscription;unavailableGateways=[s.tYF.BrainTree,s.tYF.PayGate,s.tYF.SberBank];gatewayTypes=Object.values(s.tYF).filter(t=>!this.unavailableGateways.includes(t));root=z.c.root;jwt=localStorage.getItem("ridy_admin_token");beforeUpload=(t,a)=>new _.c(o=>{const f="image/jpeg"===t.type||"image/png"===t.type;if(!f)return this.msg.error("You can only upload JPG file!"),void o.complete();const F=(t.size??0)/1024/1024<2;if(!F)return this.msg.error("Image must smaller than 2MB!"),void o.complete();o.next(f&&F),o.complete()});avatarUrl;loadingUpload=!1;constructor(t,a,o,f,F,se,le,ce){this.route=t,this.fb=a,this.updateGQL=o,this.createGQL=f,this.routerHelper=F,this.msg=se,this.modal=le,this.apollo=ce}ngOnInit(){this.form=this.fb.group({id:[null],title:[null,g.k0.required],type:[null,g.k0.required],enabled:[!0,g.k0.required],privateKey:[null,g.k0.required],publicKey:[null],saltKey:[null],merchantId:[null],mediaId:[null]}),this.subscription=this.route.data.subscribe(t=>{const a=t.paymentGateway;a?.data?.paymentGateway&&(this.form.patchValue(a.data.paymentGateway),this.avatarUrl=a.data.paymentGateway?.media?.address?this.root+a.data.paymentGateway.media.address.replace(/^\/+/,""):void 0)})}ngOnDestroy(){this.subscription?.unsubscribe()}onSubmit(){var t=this;return(0,T.A)(function*(){const{id:a,...o}=t.form.value;null==a?yield(0,i._)(t.createGQL.mutate({input:o})):yield(0,i._)(t.updateGQL.mutate({id:a,input:o})),t.routerHelper.goToParent(t.route)})()}onDelete(){var a,t=this;this.modal.confirm({nzTitle:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043f\u043e\u0441\u043e\u0431 \u043e\u043f\u043b\u0430\u0442\u044b?",nzContent:"\u042d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435\u043e\u0431\u0440\u0430\u0442\u0438\u043c\u043e. \u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?",nzOkText:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",nzOkDanger:!0,nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzOnOk:(a=(0,T.A)(function*(){const o=t.form.value.id;if(o){const f=c.Ay`
            mutation DeletePaymentGateway($id: ID!) {
              deleteOnePaymentGateway(input: { id: $id }) {
                id
              }
            }
          `;yield(0,i._)(t.apollo.mutate({mutation:f,variables:{id:o}})),t.msg.success("\u0421\u043f\u043e\u0441\u043e\u0431 \u043e\u043f\u043b\u0430\u0442\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d"),t.routerHelper.goToParent(t.route)}}),function(){return a.apply(this,arguments)})})}handleUploadChange(t){switch(t.file.status){case"uploading":this.loadingUpload=!0;break;case"done":this.loadingUpload=!1,this.form.patchValue({mediaId:t.file.response.id}),this.avatarUrl=t.file.response.address?this.root+t.file.response.address.replace(/^\/+/,""):void 0;break;case"error":this.msg.error("Network error"),this.loadingUpload=!1}}getPaymentGatewayAPIRequirements(t){if(null==t)return null;switch(t){case s.tYF.AmazonPaymentServices:return{privateKey:"Access Code",merchantId:"Merchant Identifier"};case s.tYF.BrainTree:return{privateKey:"Private key",publicKey:"Public key",merchantId:"Merchant ID"};case s.tYF.CustomLink:return{privateKey:"URL"};case s.tYF.Flutterwave:return{privateKey:"Secret Key"};case s.tYF.Instamojo:return{privateKey:"Auth Key",publicKey:"API Key"};case s.tYF.Mips:return console.log(t),{privateKey:"Cipher key",saltKey:"Salt key",publicKey:"Form ID",merchantId:"Merchant ID"};case s.tYF.MercadoPago:return{publicKey:"Public key",privateKey:"Access Token"};case s.tYF.PayTr:return{merchantId:"Merchant ID",privateKey:"Merchant key",saltKey:"Merchant salt"};case s.tYF.MyFatoorah:return{privateKey:"Private key",merchantId:"Payment Method code"};case s.tYF.MyTMoney:return{publicKey:"Public key",privateKey:"Private key",merchantId:"App Id"};case s.tYF.PayGate:return{privateKey:"Secret Key"};case s.tYF.PayPal:return{privateKey:"Client Secret",merchantId:"Client ID"};case s.tYF.PayU:return{privateKey:"Client secret",merchantId:"Merchant Pos Id"};case s.tYF.Paystack:return{privateKey:"API key"};case s.tYF.Paytm:return{privateKey:"Merchant Key",merchantId:"Merchant Id"};case s.tYF.Razorpay:return{privateKey:"Key Secret",merchantId:"Key Id"};case s.tYF.SberBank:return{publicKey:"Username",privateKey:"Password"};case s.tYF.Stripe:return{privateKey:"API key"};case s.tYF.WayForPay:return{privateKey:"Merchant secret Key",publicKey:"Merchant domain name",merchantId:"Merchant Id"};case s.tYF.BinancePay:return{publicKey:"API Key",privateKey:"Secret Key"};case s.tYF.OpenPix:return{privateKey:"AppID"}}}static \u0275fac=function(a){return new(a||n)(e.rXU(l.nX),e.rXU(g.ze),e.rXU(s.G_9),e.rXU(s.NNh),e.rXU(m.T),e.rXU(y.xh),e.rXU(u.N_),e.rXU(d.Ic))};static \u0275cmp=e.VBU({type:n,selectors:[["app-payment-gateway-view"]],standalone:!1,decls:41,vars:27,consts:[["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nzBackIcon","","nzSubtitle","API keys and client facing definitions.",3,"nzGhost","nzTitle"],["nz-button","","nzType","default","nzDanger","","type","button","class","mr-2",3,"click",4,"ngIf"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["formControlName","id","type","hidden","hidden",""],[1,"lg:grid","lg:grid-cols-4","lg:gap-2"],["nzRequired","","nzFor","title"],["nz-input","","required","","id","title","formControlName","title"],["nzRequired","","nzFor","type"],["formControlName","type","id","type"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzRequired","","nzFor","enabled"],["required","","id","enabled","formControlName","enabled"],[1,"my-2","text-sm"],["class","lg:grid lg:grid-cols-4 lg:gap-2",4,"ngIf"],["nzRequired",""],["nzListType","picture-card",3,"nzChange","nzAction","nzHeaders","nzBeforeUpload","nzShowUploadList"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-button","","nzType","primary","type","submit",1,"float-right",3,"disabled"],["nz-button","","nzType","default","nzDanger","","type","button",1,"mr-2",3,"click"],["nz-icon","","nzType","delete"],[3,"nzValue","nzLabel"],["nzFor","publicKey"],["nz-input","","formControlName","publicKey","id","publicKey"],["nzFor","privateKey"],["nz-input","","formControlName","privateKey","id","privateKey"],["nzFor","merchantId"],["nz-input","","formControlName","merchantId","id","merchantId"],["nzFor","saltKey"],["nz-input","","formControlName","saltKey","id","saltKey"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(a,o){1&a&&(e.j41(0,"form",0),e.bIt("ngSubmit",function(){return o.onSubmit()}),e.j41(1,"nz-page-header",1),e.nI1(2,"translate"),e.j41(3,"nz-page-header-extra"),e.DNE(4,L,4,3,"button",2),e.j41(5,"button",3),e.EFF(6),e.nI1(7,"translate"),e.k0s()(),e.j41(8,"nz-page-header-content"),e.nrm(9,"input",4),e.j41(10,"div",5)(11,"nz-form-item")(12,"nz-form-label",6),e.EFF(13,"Title"),e.k0s(),e.j41(14,"nz-form-control"),e.nrm(15,"input",7),e.k0s()(),e.j41(16,"nz-form-item")(17,"nz-form-label",8),e.EFF(18,"Type"),e.k0s(),e.j41(19,"nz-form-control")(20,"nz-select",9),e.DNE(21,B,1,2,"nz-option",10),e.k0s()()(),e.j41(22,"nz-form-item")(23,"nz-form-label",11),e.EFF(24),e.nI1(25,"translate"),e.k0s(),e.j41(26,"nz-form-control"),e.nrm(27,"nz-switch",12),e.k0s()()(),e.j41(28,"h3",13),e.EFF(29,"API Keys"),e.k0s(),e.DNE(30,J,5,4,"div",14),e.j41(31,"nz-form-item")(32,"nz-form-label",15),e.EFF(33,"Image"),e.k0s(),e.j41(34,"nz-form-control")(35,"nz-upload",16),e.bIt("nzChange",function(F){return o.handleUploadChange(F)}),e.DNE(36,H,5,4,"ng-container",17)(37,W,1,1,"img",18),e.k0s()()()(),e.j41(38,"button",19),e.EFF(39),e.nI1(40,"translate"),e.k0s()()()),2&a&&(e.Y8G("formGroup",o.form),e.R7$(),e.FS9("nzTitle",e.bMT(2,17,"menu.management.paymentGateways")),e.Y8G("nzGhost",!1),e.R7$(3),e.Y8G("ngIf",o.form.value.id),e.R7$(),e.Y8G("disabled",o.form.invalid),e.R7$(),e.SpI(" ",e.bMT(7,19,"profile.saveChanges")," "),e.R7$(15),e.Y8G("ngForOf",o.gatewayTypes),e.R7$(3),e.JRh(e.bMT(25,21,"profile.visibilityStatus")),e.R7$(6),e.Y8G("ngIf",o.getPaymentGatewayAPIRequirements(o.form.value.type)),e.R7$(5),e.Y8G("nzAction",o.root+"upload")("nzHeaders",e.eq3(25,V,"Bearer "+o.jwt))("nzBeforeUpload",o.beforeUpload)("nzShowUploadList",!1),e.R7$(),e.Y8G("ngIf",!o.avatarUrl),e.R7$(),e.Y8G("ngIf",o.avatarUrl),e.R7$(),e.Y8G("disabled",o.form.invalid),e.R7$(),e.JRh(e.bMT(40,23,"profile.submit")))},dependencies:[h.Sq,h.bT,g.qT,g.me,g.BC,g.cb,g.YS,g.j4,g.JD,v.Sy,K.aO,w.c,C.p,R.Dn,Y.Uq,Y.e,j.CA,j.Ls,j.Mo,j.zS,k.ld,k.WI,I.WB,I.zR,I.ov,A.$W,E.u,S.D9],encapsulation:2})}return n})(),O=(()=>{class n{gql;constructor(t){this.gql=t}resolve(t,a){return this.gql.fetch({id:t.params.id})}static \u0275fac=function(a){return new(a||n)(e.KVO(s.IjV))};static \u0275prov=e.jDH({token:n,factory:n.\u0275fac})}return n})();var M=r(6807);let D=(()=>{class n{paging;gql;constructor(t,a){this.paging=t,this.gql=a}resolve(t,a){const o=this.paging.deserializeQueryParams(t.queryParams);return this.gql.fetch(o)}static \u0275fac=function(a){return new(a||n)(e.KVO(M.a),e.KVO(s.Iko))};static \u0275prov=e.jDH({token:n,factory:n.\u0275fac})}return n})();var Z=r(6354),G=r(3359);function q(n,p){if(1&n){const t=e.RV6();e.j41(0,"img",11),e.bIt("error",function(o){return e.eBV(t),e.Njj(o.target.src="/assets/logo.png")}),e.k0s()}if(2&n){const t=e.XpG().$implicit,a=e.XpG(2);e.Y8G("src",null!=t.media&&t.media.address?t.media.address.startsWith("http")?t.media.address:a.serverUrl+t.media.address:"/assets/logo.png",e.B4B)}}function ee(n,p){if(1&n&&(e.j41(0,"tr",7)(1,"td")(2,"div",8),e.DNE(3,q,1,1,"img",9),e.j41(4,"span",10),e.EFF(5),e.k0s()()()()),2&n){const t=p.$implicit;e.Y8G("routerLink","view/"+t.id),e.R7$(3),e.Y8G("ngIf",null!=t.media),e.R7$(2),e.Lme("",t.title," (",t.type,")")}}function te(n,p){if(1&n){const t=e.RV6();e.j41(0,"nz-table",5,0),e.bIt("nzQueryParams",function(o){e.eBV(t);const f=e.XpG();return e.Njj(f.tableService.onTableQueryParamsChange(o))}),e.j41(2,"thead")(3,"tr")(4,"th"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()(),e.j41(7,"tbody"),e.DNE(8,ee,6,4,"tr",6),e.k0s()()}if(2&n){const t=p.ngIf,a=e.sdS(1);e.Y8G("nzFrontPagination",!1)("nzData",t.nodes)("nzTotal",t.totalCount),e.R7$(5),e.SpI(" ",e.bMT(6,5,"profile.title")," "),e.R7$(3),e.Y8G("ngForOf",a.data)}}const ne=[{path:"",component:(()=>{class n{route;tableService;query;serverUrl=z.c.root;constructor(t,a){this.route=t,this.tableService=a}ngOnInit(){this.query=this.route.data.pipe((0,Z.T)(t=>t.paymentGateways))}static \u0275fac=function(a){return new(a||n)(e.rXU(l.nX),e.rXU(M.a))};static \u0275cmp=e.VBU({type:n,selectors:[["app-payment-gateways-list"]],standalone:!1,decls:9,vars:7,consts:[["table",""],["nzBackIcon","","nzTitle","Payment Gateways","nzSubtitle","Payment options of clients",3,"nzGhost"],["nz-button","","nzType","primary","routerLink","new"],["nz-icon","","nzType","plus"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzQueryParams","nzFrontPagination","nzData","nzTotal"],["class","group cursor-pointer",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","cursor-pointer",3,"routerLink"],[1,"flex","flex-row","items-center"],["width","32","height","32","loading","lazy","style","object-fit: contain; border-radius: 4px;",3,"src","error",4,"ngIf"],[1,"ml-2"],["width","32","height","32","loading","lazy",2,"object-fit","contain","border-radius","4px",3,"error","src"]],template:function(a,o){if(1&a&&(e.j41(0,"nz-page-header",1)(1,"nz-page-header-extra")(2,"button",2),e.nrm(3,"i",3),e.EFF(4),e.nI1(5,"translate"),e.k0s()(),e.j41(6,"nz-page-header-content"),e.DNE(7,te,9,7,"nz-table",4),e.nI1(8,"async"),e.k0s()()),2&a){let f;e.Y8G("nzGhost",!1),e.R7$(4),e.JRh(e.bMT(5,3,"profile.add")),e.R7$(3),e.Y8G("ngIf",null==(f=e.bMT(8,5,o.query))||null==f.data?null:f.data.paymentGateways)}},dependencies:[h.Sq,h.bT,b.Wk,G.CP,G.SO,G._4,G.IL,G.aj,G.kt,K.aO,w.c,C.p,R.Dn,I.WB,I.zR,I.ov,h.Jj,S.D9],encapsulation:2})}return n})(),resolve:{paymentGateways:D},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"view/:id",component:$,resolve:{paymentGateway:O}},{path:"new",component:$}];let ae=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.$C({type:n});static \u0275inj=e.G2t({providers:[D,O],imports:[b.iI.forChild(ne),b.iI]})}return n})();var re=r(2067),oe=r(5885);let ie=(()=>{class n{static \u0275fac=function(a){return new(a||n)};static \u0275mod=e.$C({type:n});static \u0275inj=e.G2t({providers:[re.t],imports:[h.MD,ae,oe.G]})}return n})()},6807:(U,P,r)=>{r.d(P,{a:()=>T});var h=r(1360),b=r(2209);let T=(()=>{class z{router;route;constructor(i,c){this.router=i,this.route=c}serializeQueryParams(i,c){const e={};if(e.pageIndex=i.pageIndex,e.pageSize=i.pageSize,null!=i.filter){const l=i.filter.filter(m=>null!=m.value&&m.value.length>0).map(m=>`${m.key}|${Array.isArray(m.value)?"in":"eq"}|${Array.isArray(m.value)?m.value.join("-"):m.value}`);null!=c.filter&&l.push(...c.filter.split(",")),e.filter=l.length>0?l.join(","):void 0}if(null!=i.sort&&i.sort.length>0){const l=i.sort.filter(m=>null!=m.value).map(m=>`${m.key}|${"ascend"==m.value?"ASC":"DESC"}`);null!=c.sort&&l.push(...c.sort.split(",")),e.sort=l.length>0?l.join(","):void 0}return e}onTableQueryParamsChange(i){const c=this.serializeQueryParams(i,this.route.snapshot.queryParams);this.router.navigate([],{relativeTo:this.route,queryParams:c,queryParamsHandling:"merge"})}filterText(i,c){const l=this.deserializeQueryParams(this.route).filter??{};l[i]=null!=c?{like:c}:{};const m=Object.keys(l).map(u=>{if(Object.keys(l[u]).length<1)return null;const d=Object.keys(l[u])[0];return`${u}|${d}|${"in"==d?l[u][d].join("-"):l[u][d]}`}).filter(u=>null!=u),y=m.length>0?m.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:y},queryParamsHandling:"merge"})}filterRange(i,c){const l=this.deserializeQueryParams(this.route).filter??{};l[i]=null!=c?{between:c}:{};const m=Object.keys(l).map(u=>{if(Object.keys(l[u]).length<1)return null;const d=Object.keys(l[u])[0];return`${u}|${d}|${"in"==d||"between"==d?l[u][d].join("-"):l[u][d]}`}).filter(u=>null!=u),y=m.length>0?m.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:y},queryParamsHandling:"merge"})}resetFilter(i,c){this.filterText(i,void 0),c.value=""}downloadURI(i,c){const e=document.createElement("a");e.download=c,e.href=i,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)}deserializeQueryParams(i){const c=i.sort?i.sort.split(",").map(y=>({field:y.split("|")[0],direction:y.split("|")[1]})):[],e={};null!=i.filter&&i.filter.split(",").forEach(y=>{const u={},d=y.split("|")[1];if("in"==d){const v=y.split("|")[2].split("-");u[d]=v}else if("between"==d){const v=y.split("|")[2].split("-");u[d]={lower:v[0],upper:v[1]}}else u[d]=y.split("|")[2];e[y.split("|")[0]]=u});const l=null!=i.pageIndex?parseInt(i.pageIndex):1,m=null!=i.pageSize?parseInt(i.pageSize):10;return{sorting:c.length>0?c:void 0,paging:{offset:(l-1)*m,limit:m},filter:null!=e&&Object.keys(e).length>0?e:void 0}}static \u0275fac=function(c){return new(c||z)(h.KVO(b.Ix),h.KVO(b.nX))};static \u0275prov=h.jDH({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})()}}]);