"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[208],{3208:(nn,f,a)=>{a.r(f),a.d(f,{ConfigModule:()=>W});var d=a(8434),C=a(6501),g=a(7624),u=a(467),c=a(3241),M=a(8204),G=a(6354),l=a(4843),n=a(1360),m=a(2209),h=a(7094),p=a(9417),P=a(3617),j=a(1011),I=a(513),x=a(6389),T=a(5930),k=a(1951),_=a(1997),F=a(2358),z=a(8182),v=a(2542);const S=["tplContent"],A=["tplFooter"];function R(e,s){if(1&e&&(n.j41(0,"nz-steps",8),n.nrm(1,"nz-step",9)(2,"nz-step",10)(3,"nz-step",11),n.k0s()),2&e){const t=n.XpG();n.Y8G("nzCurrent",t.currentStep)}}function V(e,s){if(1&e){const t=n.RV6();n.j41(0,"div",12)(1,"input",13),n.mxI("ngModelChange",function(o){n.eBV(t);const i=n.XpG();return n.DH7(i.currentConfig.currentConfiguration.purchaseCode,o)||(i.currentConfig.currentConfiguration.purchaseCode=o),n.Njj(o)}),n.k0s(),n.j41(2,"input",14),n.mxI("ngModelChange",function(o){n.eBV(t);const i=n.XpG();return n.DH7(i.email,o)||(i.email=o),n.Njj(o)}),n.k0s(),n.nrm(3,"nz-alert",15),n.k0s()}if(2&e){const t=n.XpG();n.R7$(),n.R50("ngModel",t.currentConfig.currentConfiguration.purchaseCode),n.R7$(),n.R50("ngModel",t.email)}}function K(e,s){if(1&e){const t=n.RV6();n.j41(0,"div",12)(1,"input",16),n.mxI("ngModelChange",function(o){n.eBV(t);const i=n.XpG();return n.DH7(i.currentConfig.currentConfiguration.backendMapsAPIKey,o)||(i.currentConfig.currentConfiguration.backendMapsAPIKey=o),n.Njj(o)}),n.k0s(),n.j41(2,"input",17),n.mxI("ngModelChange",function(o){n.eBV(t);const i=n.XpG();return n.DH7(i.currentConfig.currentConfiguration.adminPanelAPIKey,o)||(i.currentConfig.currentConfiguration.adminPanelAPIKey=o),n.Njj(o)}),n.k0s()()}if(2&e){const t=n.XpG();n.R7$(),n.R50("ngModel",t.currentConfig.currentConfiguration.backendMapsAPIKey),n.R7$(),n.R50("ngModel",t.currentConfig.currentConfiguration.adminPanelAPIKey)}}function D(e,s){if(1&e){const t=n.RV6();n.j41(0,"div",12)(1,"nz-upload",18),n.bIt("nzChange",function(o){n.eBV(t);const i=n.XpG();return n.Njj(i.handleChange(o))}),n.j41(2,"p",19),n.nrm(3,"i",20),n.k0s(),n.j41(4,"p",21),n.EFF(5,"Firebase Project Private Key"),n.k0s(),n.j41(6,"p",22),n.EFF(7," Upload private key json file received from firebase project under Service Account and by clicking on the `Generate Private Key` button. "),n.k0s()()()}if(2&e){const t=n.XpG();n.R7$(),n.Y8G("nzAction",t.root+"config/upload")}}function X(e,s){if(1&e){const t=n.RV6();n.j41(0,"button",26),n.bIt("click",function(){n.eBV(t);const o=n.XpG(2);return n.Njj(o.pre())}),n.EFF(1,"Previous"),n.k0s()}}function Y(e,s){if(1&e){const t=n.RV6();n.j41(0,"button",27),n.bIt("click",function(){n.eBV(t);const o=n.XpG(2);return n.Njj(o.next())}),n.EFF(1,"Next"),n.k0s()}}function B(e,s){if(1&e){const t=n.RV6();n.j41(0,"button",27),n.bIt("click",function(){n.eBV(t);const o=n.XpG(2);return n.Njj(o.done())}),n.EFF(1,"Done"),n.k0s()}}function O(e,s){if(1&e&&(n.j41(0,"div",23),n.DNE(1,X,2,0,"button",24)(2,Y,2,0,"button",25)(3,B,2,0,"button",25),n.k0s()),2&e){const t=n.XpG();n.R7$(),n.Y8G("ngIf",t.currentStep>0),n.R7$(),n.Y8G("ngIf",t.currentStep<2),n.R7$(),n.Y8G("ngIf",2===t.currentStep)}}function N(e,s){1&e&&(n.j41(0,"nz-result",28)(1,"div",29)(2,"button",30),n.EFF(3,"Go Login"),n.k0s()()())}function w(e,s){if(1&e&&n.nrm(0,"nz-option",33),2&e){const t=s.$implicit;n.Y8G("nzValue",t)("nzLabel",t)}}function U(e,s){if(1&e){const t=n.RV6();n.j41(0,"p"),n.EFF(1,"This purchase code seems to have been used by another server `in past`/`right now`. You can select to disable the previous server from below list and continue using on this server."),n.k0s(),n.j41(2,"nz-select",31),n.mxI("ngModelChange",function(o){n.eBV(t);const i=n.XpG();return n.DH7(i.selectedClient,o)||(i.selectedClient=o),n.Njj(o)}),n.DNE(3,w,1,2,"nz-option",32),n.k0s()}if(2&e){const t=n.XpG();n.R7$(2),n.R50("ngModel",t.selectedClient),n.R7$(),n.Y8G("ngForOf",t.clients)}}function E(e,s){if(1&e){const t=n.RV6();n.j41(0,"button",34),n.bIt("click",function(){n.eBV(t);const o=n.XpG();return n.Njj(o.disableServer())}),n.EFF(1," Disable Selected Server "),n.k0s()}if(2&e){const t=n.XpG();n.Y8G("nzLoading",t.tplModalButtonLoading)("disabled",null===t.selectedClient)}}let L=(()=>{class e{route;updatePurchaseGql;updateMapsGql;updateFirebaseGql;disableServerGql;modalService;msg;currentStep=0;tplModal;remoteConfig;currentConfig;email;root=M.c.root;clients=[];selectedClient;configed=!1;tplModalButtonLoading=!1;clientModalContent;clientModalFooter;configSubscription;constructor(t,r,o,i,J,Z,q){this.route=t,this.updatePurchaseGql=r,this.updateMapsGql=o,this.updateFirebaseGql=i,this.disableServerGql=J,this.modalService=Z,this.msg=q}ngOnInit(){this.remoteConfig=this.route.data.pipe((0,G.T)(t=>t.config)),this.configSubscription=this.remoteConfig.subscribe(t=>this.currentConfig=t.data)}ngOnDestroy(){this.configSubscription?.unsubscribe()}pre(){this.currentStep-=1}next(){var t=this;return(0,u.A)(function*(){switch(t.currentStep){case 0:{if(null==t.currentConfig.currentConfiguration.purchaseCode)return void t.msg.error("Purchase code is invalid.");const r=yield(0,l._)(t.updatePurchaseGql.mutate({code:t.currentConfig.currentConfiguration.purchaseCode??"",email:t.email}));if(console.log(r),r.data?.updatePurchaseCode.status==c.gFS.ClientFound)return t.clients=r.data?.updatePurchaseCode.clients?.map(o=>o.ip)??[],void t.createClientsModal();r.data?.updatePurchaseCode.status==c.gFS.Invalid&&t.msg.error(r.data.updatePurchaseCode.message??"An unknown error occured, please contact through the customer panel at support@ridy.io for more information."),r.data?.updatePurchaseCode.status==c.gFS.Ok&&(t.currentStep+=1);break}case 1:{if(null==t.currentConfig.currentConfiguration.adminPanelAPIKey||t.currentConfig.currentConfiguration.adminPanelAPIKey.length<10||null==t.currentConfig.currentConfiguration.backendMapsAPIKey||t.currentConfig.currentConfiguration.backendMapsAPIKey.length<10)return void t.msg.error("Google Maps API Keys seems invalid.");const r=yield(0,l._)(t.updateMapsGql.mutate({backend:t.currentConfig.currentConfiguration.backendMapsAPIKey,adminPanel:t.currentConfig.currentConfiguration.adminPanelAPIKey}));r.data?.updateMapsAPIKey.status==c.M9D.Ok?t.currentStep+=1:t.msg.error(r.data?.updateMapsAPIKey.message??"Unknown Error");break}}})()}createClientsModal(){this.tplModal=this.modalService.create({nzTitle:"License Verification",nzContent:this.clientModalContent,nzFooter:this.clientModalFooter,nzMaskClosable:!1,nzClosable:!1})}disableServer(){var t=this;return(0,u.A)(function*(){t.tplModalButtonLoading=!0,yield(0,l._)(t.disableServerGql.mutate({ip:t.selectedClient})),t.msg.success("Disable was successful."),t.tplModal.close()})()}done(){var t=this;return(0,u.A)(function*(){if(null==t.currentConfig.currentConfiguration.firebaseProjectPrivateKey)return void t.msg.error("Firebase Project key seems invalid.");const r=yield(0,l._)(t.updateFirebaseGql.mutate({keyFileName:t.currentConfig.currentConfiguration.firebaseProjectPrivateKey}));r.data?.updateFirebase.status==c.M9D.Ok?t.configed=!0:t.msg.error(r.data?.updateFirebase.message??"Unknown error")})()}handleChange(t){const r=t.file.status;"done"===r?(this.msg.success(`${t.file.name} file uploaded successfully.`),this.currentConfig.currentConfiguration.firebaseProjectPrivateKey=t.file.name):"error"===r&&this.msg.error(`${t.file.name} file upload failed.`)}static \u0275fac=function(r){return new(r||e)(n.rXU(m.nX),n.rXU(c.sG0),n.rXU(c.Q52),n.rXU(c.Jri),n.rXU(c.ekH),n.rXU(C.N_),n.rXU(h.xh))};static \u0275cmp=n.VBU({type:e,selectors:[["app-config"]],viewQuery:function(r,o){if(1&r&&(n.GBs(S,5),n.GBs(A,5)),2&r){let i;n.mGM(i=n.lsd())&&(o.clientModalContent=i.first),n.mGM(i=n.lsd())&&(o.clientModalFooter=i.first)}},standalone:!1,decls:12,vars:6,consts:[["tplContent",""],["tplFooter",""],[1,"flex","items-center","justify-center","min-h-screen","bg-dark-blue"],[1,"bg-white","dark:bg-gray-900","p-8","max-w-4xl","w-full"],["class","m-8 w-auto",3,"nzCurrent",4,"ngIf"],["class","step-content",4,"ngIf"],["class","steps-action",4,"ngIf"],["nzStatus","success","nzTitle","Configuration Done!","nzSubTitle","Your configuration steps are done now! You will need to wait for around 30 seconds so system would set it up then you can go to login screen using button below.",4,"ngIf"],[1,"m-8","w-auto",3,"nzCurrent"],["nzTitle","Purchase Code","nzDescription","License Verification"],["nzTitle","Maps API","nzDescription","Google Maps API Keys"],["nzTitle","Firebase Admin SDK","nzDescription","Notification & Auth"],[1,"step-content"],["nz-input","","placeholder","Purchase Code",3,"ngModelChange","ngModel"],["nz-input","","placeholder","E-mail address",3,"ngModelChange","ngModel"],["nzType","info","nzShowIcon","","nzMessage","Important:","nzDescription","The email address you have provided will be used exclusively for important updates regarding your license inquiries, such as abuse reports, disablement notices, and other critical notifications.",1,"m-4"],["nz-input","","placeholder","Backend Maps API key",3,"ngModelChange","ngModel"],["nz-input","","placeholder","Dashboard Maps API key",3,"ngModelChange","ngModel"],["nzType","drag","nzAccept",".json,application/json",3,"nzChange","nzAction"],[1,"ant-upload-drag-icon"],["nz-icon","","nzType","inbox"],[1,"ant-upload-text"],[1,"ant-upload-hint"],[1,"steps-action"],["nz-button","","nzType","default",3,"click",4,"ngIf"],["nz-button","","nzType","primary",3,"click",4,"ngIf"],["nz-button","","nzType","default",3,"click"],["nz-button","","nzType","primary",3,"click"],["nzStatus","success","nzTitle","Configuration Done!","nzSubTitle","Your configuration steps are done now! You will need to wait for around 30 seconds so system would set it up then you can go to login screen using button below."],["nz-result-extra",""],["nz-button","","nzType","primary","routerLink","../login"],["nzAllowClear","","nzPlaceHolder","Choose",2,"width","100%",3,"ngModelChange","ngModel"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"],["nz-button","","nzType","primary",3,"click","nzLoading","disabled"]],template:function(r,o){1&r&&(n.j41(0,"div",2)(1,"div",3),n.DNE(2,R,4,1,"nz-steps",4)(3,V,4,2,"div",5)(4,K,3,2,"div",5)(5,D,8,1,"div",5)(6,O,4,3,"div",6)(7,N,4,0,"nz-result",7)(8,U,4,2,"ng-template",null,0,n.C5r)(10,E,2,2,"ng-template",null,1,n.C5r),n.k0s()()),2&r&&(n.R7$(2),n.Y8G("ngIf",!o.configed),n.R7$(),n.Y8G("ngIf",0===o.currentStep),n.R7$(),n.Y8G("ngIf",1===o.currentStep),n.R7$(),n.Y8G("ngIf",2===o.currentStep&&!o.configed),n.R7$(),n.Y8G("ngIf",!o.configed),n.R7$(),n.Y8G("ngIf",o.configed))},dependencies:[d.Sq,d.bT,g.Wk,p.me,p.BC,p.vS,P.Y,j.Sy,I.aO,x.c,T.p,k.Dn,_.ld,_.WI,F.$W,z.XM,z.oM,v.zU,v.H4],styles:[".steps-action[_ngcontent-%COMP%]{display:block;margin-left:10px;margin-top:24px}button[_ngcontent-%COMP%]{margin-right:8px}.step-content[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px;margin-top:16px;border:1px dashed #e9e9e9;border-radius:6px}.step-content[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .step-content[_ngcontent-%COMP%]   nz-upload[_ngcontent-%COMP%]{width:90%;display:block;margin:50px auto}"]})}return e})(),y=(()=>{class e{router;msg;currentConfigGql;constructor(t,r,o){this.router=t,this.msg=r,this.currentConfigGql=o}canActivate(t,r){var o=this;return(0,u.A)(function*(){const i=yield(0,l._)(o.currentConfigGql.fetch({}));return null==i.data.currentConfiguration.firebaseProjectPrivateKey||null==i.data.currentConfiguration.purchaseCode||(o.msg.warning("System is already configured. Try with admin password parameter"),o.router.navigate(["../login"]),!1)})()}static \u0275fac=function(r){return new(r||e)(n.KVO(m.Ix),n.KVO(h.xh),n.KVO(c.UpR))};static \u0275prov=n.jDH({token:e,factory:e.\u0275fac})}return e})(),b=(()=>{class e{currentConfigGql;constructor(t){this.currentConfigGql=t}resolve(t,r){return this.currentConfigGql.fetch({})}static \u0275fac=function(r){return new(r||e)(n.KVO(c.UpR))};static \u0275prov=n.jDH({token:e,factory:e.\u0275fac})}return e})();const $=[{path:"",component:L,canActivate:[y],resolve:{config:b}}];let H=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=n.$C({type:e});static \u0275inj=n.G2t({providers:[y,b],imports:[g.iI.forChild($),g.iI]})}return e})();var Q=a(5885);let W=(()=>{class e{static \u0275fac=function(r){return new(r||e)};static \u0275mod=n.$C({type:e});static \u0275inj=n.G2t({providers:[C.N_],imports:[d.MD,H,Q.G]})}return e})()}}]);