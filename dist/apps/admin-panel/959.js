"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[959],{4959:(E,j,a)=>{a.r(j),a.d(j,{PayoutMethodsModule:()=>st});var v=a(7624),R=a(6807),F=a(8204),P=a(6354),t=a(1360),g=a(2209),T=a(8434),i=a(3359),s=a(513),c=a(6389),l=a(5930),u=a(1951),p=a(3062),d=a(8018);function h(n,m){if(1&n&&t.nrm(0,"img",11),2&n){const e=t.XpG().$implicit,r=t.XpG(2);t.Y8G("src",r.getImageUrl(null==e.media?null:e.media.address),t.B4B)}}function y(n,m){if(1&n&&(t.j41(0,"tr",7)(1,"td")(2,"div",8),t.DNE(3,h,1,1,"img",9),t.j41(4,"span",10),t.EFF(5),t.k0s()()()()),2&n){const e=m.$implicit;t.Y8G("routerLink",e.id+"/edit"),t.R7$(3),t.Y8G("ngIf",null!==e.media),t.R7$(2),t.Lme("",e.name," (",e.type,")")}}function L(n,m){if(1&n){const e=t.RV6();t.j41(0,"nz-table",5,0),t.bIt("nzQueryParams",function(o){t.eBV(e);const f=t.XpG();return t.Njj(f.tableService.onTableQueryParamsChange(o))}),t.j41(2,"thead")(3,"tr")(4,"th"),t.EFF(5),t.nI1(6,"translate"),t.k0s()()(),t.j41(7,"tbody"),t.DNE(8,y,6,4,"tr",6),t.k0s()()}if(2&n){const e=m.ngIf,r=t.sdS(1);t.Y8G("nzFrontPagination",!1)("nzData",e)("nzTotal",e.length),t.R7$(5),t.SpI(" ",t.bMT(6,5,"profile.title")," "),t.R7$(3),t.Y8G("ngForOf",r.data)}}let V=(()=>{class n{route;tableService;query;serverUrl=F.c.root;imageBaseUrl=`${window.location.protocol}//${window.location.hostname.toString()}/`;constructor(e,r){this.route=e,this.tableService=r}ngOnInit(){this.query=this.route.data.pipe((0,P.T)(e=>e.payoutMethods))}getImageUrl(e){if(console.log("\u{1f5bc}\ufe0f getImageUrl called:",{address:e,serverUrl:this.serverUrl,imageBaseUrl:this.imageBaseUrl}),!e)return console.log("\u{1f5bc}\ufe0f No address, returning fallback"),"/assets/logo.png";if(e.startsWith("http"))return console.log("\u{1f5bc}\ufe0f Full URL detected:",e),e;if(e.startsWith("/")){const o=e.replace(/^\/+/,""),f=this.serverUrl+o;return console.log("\u{1f5bc}\ufe0f Path with slash:",{address:e,cleanAddress:o,result:f}),f}const r=this.serverUrl+e;return console.log("\u{1f5bc}\ufe0f Regular path:",{address:e,result:r}),r}static \u0275fac=function(r){return new(r||n)(t.rXU(g.nX),t.rXU(R.a))};static \u0275cmp=t.VBU({type:n,selectors:[["app-payout-methods-list"]],standalone:!1,decls:9,vars:7,consts:[["table",""],["nzBackIcon","","nzTitle","Payout Methods","nzSubtitle","Payout options available to service providers.",3,"nzGhost"],["nz-button","","nzType","primary","routerLink","new"],["nz-icon","","nzType","plus"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzQueryParams","nzFrontPagination","nzData","nzTotal"],["class","group cursor-pointer",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","cursor-pointer",3,"routerLink"],[1,"flex","flex-row","items-center"],["width","32","height","32",3,"src",4,"ngIf"],[1,"ml-2"],["width","32","height","32",3,"src"]],template:function(r,o){if(1&r&&(t.j41(0,"nz-page-header",1)(1,"nz-page-header-extra")(2,"button",2),t.nrm(3,"i",3),t.EFF(4),t.nI1(5,"translate"),t.k0s()(),t.j41(6,"nz-page-header-content"),t.DNE(7,L,9,7,"nz-table",4),t.nI1(8,"async"),t.k0s()()),2&r){let f;t.Y8G("nzGhost",!1),t.R7$(4),t.JRh(t.bMT(5,3,"profile.add")),t.R7$(3),t.Y8G("ngIf",null==(f=t.bMT(8,5,o.query))||null==f.data||null==f.data.payoutMethods?null:f.data.payoutMethods.nodes)}},dependencies:[T.Sq,T.bT,i.CP,i.SO,i._4,i.IL,i.aj,i.kt,s.aO,c.c,l.p,u.Dn,p.WB,p.zR,p.ov,v.Wk,T.Jj,d.D9],encapsulation:2})}return n})();var b=a(3241),G=a(7094),$=a(467),z=a(9417),K=a(6195),_=a(1985),M=a(4843),D=a(9996),Y=a(712),w=a(6501),A=a(3039),B=a(1011),U=a(7529),C=a(8927),O=a(1997),X=a(2358),N=a(7481);const Q=n=>({Authorization:n});function x(n,m){if(1&n){const e=t.RV6();t.j41(0,"button",25),t.bIt("click",function(){t.eBV(e);const o=t.XpG();return t.Njj(o.onDelete())}),t.nrm(1,"i",26),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&n&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"profile.delete")," "))}function J(n,m){if(1&n&&t.nrm(0,"nz-option",27),2&n){const e=m.$implicit;t.Y8G("nzLabel",e.label)("nzValue",e.value)}}function W(n,m){if(1&n&&t.nrm(0,"nz-option",28),2&n){const e=m.$implicit;t.Y8G("nzValue",e)("nzLabel",e)}}function H(n,m){1&n&&(t.j41(0,"h3",29),t.EFF(1,"API Keys "),t.k0s())}function Z(n,m){if(1&n&&(t.j41(0,"nz-form-item")(1,"nz-form-label",30),t.EFF(2),t.k0s(),t.j41(3,"nz-form-control"),t.nrm(4,"input",31),t.k0s()()),2&n){const e=t.XpG().ngIf;t.R7$(2),t.JRh(e.publicKey)}}function q(n,m){if(1&n&&(t.j41(0,"nz-form-item")(1,"nz-form-label",32),t.EFF(2),t.k0s(),t.j41(3,"nz-form-control"),t.nrm(4,"input",33),t.k0s()()),2&n){const e=t.XpG().ngIf;t.R7$(2),t.JRh(e.privateKey)}}function tt(n,m){if(1&n&&(t.j41(0,"nz-form-item")(1,"nz-form-label",34),t.EFF(2),t.k0s(),t.j41(3,"nz-form-control"),t.nrm(4,"input",35),t.k0s()()),2&n){const e=t.XpG().ngIf;t.R7$(2),t.JRh(e.merchantId)}}function et(n,m){if(1&n&&(t.j41(0,"nz-form-item")(1,"nz-form-label",36),t.EFF(2),t.k0s(),t.j41(3,"nz-form-control"),t.nrm(4,"input",37),t.k0s()()),2&n){const e=t.XpG().ngIf;t.R7$(2),t.JRh(e.saltKey)}}function nt(n,m){if(1&n&&(t.j41(0,"div",5),t.DNE(1,Z,5,1,"nz-form-item",22)(2,q,5,1,"nz-form-item",22)(3,tt,5,1,"nz-form-item",22)(4,et,5,1,"nz-form-item",22),t.k0s()),2&n){const e=m.ngIf;t.R7$(),t.Y8G("ngIf",null!=e.publicKey),t.R7$(),t.Y8G("ngIf",null!=e.privateKey),t.R7$(),t.Y8G("ngIf",null!=e.merchantId),t.R7$(),t.Y8G("ngIf",null!=e.saltKey)}}function ot(n,m){if(1&n&&(t.qex(0),t.nrm(1,"i",38),t.j41(2,"div",39),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.bVm()),2&n){const e=t.XpG();t.R7$(),t.Y8G("nzType",e.loadingUpload?"loading":"plus"),t.R7$(2),t.JRh(t.bMT(4,2,"profile.upload"))}}function rt(n,m){if(1&n&&t.nrm(0,"img",40),2&n){const e=t.XpG();t.Y8G("src",e.avatarUrl,t.B4B)}}let S=(()=>{class n{route;fb;updateGQL;createGQL;routerHelper;msg;modal;apollo;form;subscription;methodTypes=Object.keys(b.UCp);root=F.c.root;jwt=localStorage.getItem("ridy_admin_token");beforeUpload=(e,r)=>new _.c(o=>{const f="image/jpeg"===e.type||"image/png"===e.type;if(!f)return this.msg.error("You can only upload JPG file!"),void o.complete();const I=(e.size??0)/1024/1024<2;if(!I)return this.msg.error("Image must smaller than 2MB!"),void o.complete();o.next(f&&I),o.complete()});avatarUrl;loadingUpload=!1;currencies=K.P;constructor(e,r,o,f,I,ut,dt,ct){this.route=e,this.fb=r,this.updateGQL=o,this.createGQL=f,this.routerHelper=I,this.msg=ut,this.modal=dt,this.apollo=ct}ngOnInit(){this.form=this.fb.group({id:[null],name:[null,z.k0.required],currency:[null,z.k0.required],description:[null],type:[null,z.k0.required],enabled:[!0,z.k0.required],privateKey:[null],publicKey:[null],saltKey:[null],merchantId:[null],mediaId:[null]}),this.subscription=this.route.data.subscribe(e=>{const r=e.payoutMethod;r?.data?.payoutMethod&&(this.form.patchValue(r.data.payoutMethod),this.avatarUrl=r.data.payoutMethod?.media?.address?this.root+r.data.payoutMethod.media.address.replace(/^\/+/,""):void 0)})}ngOnDestroy(){this.subscription?.unsubscribe()}onSubmit(){var e=this;return(0,$.A)(function*(){const{id:r,...o}=e.form.value;null==r?yield(0,M._)(e.createGQL.mutate({input:o})):yield(0,M._)(e.updateGQL.mutate({id:r,update:o})),e.routerHelper.goToParent(e.route)})()}onDelete(){var r,e=this;this.modal.confirm({nzTitle:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043f\u043e\u0441\u043e\u0431 \u0432\u044b\u043f\u043b\u0430\u0442\u044b?",nzContent:"\u042d\u0442\u043e \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0435 \u043d\u0435\u043e\u0431\u0440\u0430\u0442\u0438\u043c\u043e. \u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?",nzOkText:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",nzOkDanger:!0,nzCancelText:"\u041e\u0442\u043c\u0435\u043d\u0430",nzOnOk:(r=(0,$.A)(function*(){const o=e.form.value.id;if(o){const f=D.Ay`
            mutation DeletePayoutMethod($id: ID!) {
              deleteOnePayoutMethod(input: { id: $id }) {
                id
              }
            }
          `;yield(0,M._)(e.apollo.mutate({mutation:f,variables:{id:o}})),e.msg.success("\u0421\u043f\u043e\u0441\u043e\u0431 \u0432\u044b\u043f\u043b\u0430\u0442\u044b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0443\u0434\u0430\u043b\u0435\u043d"),e.routerHelper.goToParent(e.route)}}),function(){return r.apply(this,arguments)})})}handleUploadChange(e){switch(e.file.status){case"uploading":this.loadingUpload=!0;break;case"done":this.loadingUpload=!1,this.form.patchValue({mediaId:e.file.response.id}),this.avatarUrl=e.file.response.address?this.root+e.file.response.address.replace(/^\/+/,""):void 0;break;case"error":this.msg.error("Network error"),this.loadingUpload=!1}}getPaymentGatewayAPIRequirements(e){if(null==e)return null;switch(e){case b.UCp.Stripe:return{privateKey:"API key"};case b.UCp.BankTransfer:return null}}static \u0275fac=function(r){return new(r||n)(t.rXU(g.nX),t.rXU(z.ze),t.rXU(b.BS$),t.rXU(b.QwY),t.rXU(Y.T),t.rXU(G.xh),t.rXU(w.N_),t.rXU(A.Ic))};static \u0275cmp=t.VBU({type:n,selectors:[["app-payout-methods-view"]],standalone:!1,decls:53,vars:35,consts:[["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["nzBackIcon","","nzSubtitle","API keys and client facing definitions.",3,"nzGhost","nzTitle"],["nz-button","","nzType","default","nzDanger","","type","button","class","mr-2",3,"click",4,"ngIf"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["formControlName","id","type","hidden","hidden",""],[1,"lg:grid","lg:grid-cols-4","lg:gap-2"],["nzRequired","","nzFor","name"],["nz-input","","required","","id","name","formControlName","name"],["nzRequired","","nzFor","description"],["nz-input","","required","","id","description","formControlName","description"],["nzRequired","","nzFor","currency"],["formControlName","currency","id","currency","nzShowSearch",""],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzRequired","","nzFor","type"],["formControlName","type","id","type"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],["nzRequired","","nzFor","enabled"],["required","","id","enabled","formControlName","enabled"],["class","my-2 text-sm",4,"ngIf"],["class","lg:grid lg:grid-cols-4 lg:gap-2",4,"ngIf"],["nzRequired",""],["nzListType","picture-card",3,"nzChange","nzAction","nzHeaders","nzBeforeUpload","nzShowUploadList"],[4,"ngIf"],["style","width: 100%",3,"src",4,"ngIf"],["nz-button","","nzType","primary","type","submit",1,"float-right",3,"disabled"],["nz-button","","nzType","default","nzDanger","","type","button",1,"mr-2",3,"click"],["nz-icon","","nzType","delete"],[3,"nzLabel","nzValue"],[3,"nzValue","nzLabel"],[1,"my-2","text-sm"],["nzFor","publicKey"],["required","","nz-input","","formControlName","publicKey","id","publicKey"],["nzFor","privateKey"],["nz-input","","formControlName","privateKey","id","privateKey"],["nzRequired","","nzFor","merchantId"],["nz-input","","formControlName","merchantId","id","merchantId"],["nzRequired","","nzFor","saltKey"],["nz-input","","formControlName","saltKey","id","saltKey"],["nz-icon","",1,"upload-icon",3,"nzType"],[1,"ant-upload-text"],[2,"width","100%",3,"src"]],template:function(r,o){1&r&&(t.j41(0,"form",0),t.bIt("ngSubmit",function(){return o.onSubmit()}),t.j41(1,"nz-page-header",1),t.nI1(2,"translate"),t.j41(3,"nz-page-header-extra"),t.DNE(4,x,4,3,"button",2),t.j41(5,"button",3),t.EFF(6),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"nz-page-header-content"),t.nrm(9,"input",4),t.j41(10,"div",5)(11,"nz-form-item")(12,"nz-form-label",6),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"nz-form-control"),t.nrm(16,"input",7),t.k0s()(),t.j41(17,"nz-form-item")(18,"nz-form-label",8),t.EFF(19),t.nI1(20,"translate"),t.k0s(),t.j41(21,"nz-form-control"),t.nrm(22,"input",9),t.k0s()(),t.j41(23,"nz-form-item")(24,"nz-form-label",10),t.EFF(25,"Currency"),t.k0s(),t.j41(26,"nz-form-control")(27,"nz-select",11),t.DNE(28,J,1,2,"nz-option",12),t.k0s()()(),t.j41(29,"nz-form-item")(30,"nz-form-label",13),t.EFF(31,"Type"),t.k0s(),t.j41(32,"nz-form-control")(33,"nz-select",14),t.DNE(34,W,1,2,"nz-option",15),t.k0s()()(),t.j41(35,"nz-form-item")(36,"nz-form-label",16),t.EFF(37),t.nI1(38,"translate"),t.k0s(),t.j41(39,"nz-form-control"),t.nrm(40,"nz-switch",17),t.k0s()()(),t.DNE(41,H,2,0,"h3",18)(42,nt,5,4,"div",19),t.j41(43,"nz-form-item")(44,"nz-form-label",20),t.EFF(45,"Image"),t.k0s(),t.j41(46,"nz-form-control")(47,"nz-upload",21),t.bIt("nzChange",function(I){return o.handleUploadChange(I)}),t.DNE(48,ot,5,4,"ng-container",22)(49,rt,1,1,"img",23),t.k0s()()()(),t.j41(50,"button",24),t.EFF(51),t.nI1(52,"translate"),t.k0s()()()),2&r&&(t.Y8G("formGroup",o.form),t.R7$(),t.FS9("nzTitle",t.bMT(2,21,"menu.payoutMethods")),t.Y8G("nzGhost",!1),t.R7$(3),t.Y8G("ngIf",o.form.value.id),t.R7$(),t.Y8G("disabled",o.form.invalid),t.R7$(),t.SpI(" ",t.bMT(7,23,"profile.saveChanges")," "),t.R7$(7),t.JRh(t.bMT(14,25,"profile.name")),t.R7$(6),t.JRh(t.bMT(20,27,"profile.description")),t.R7$(9),t.Y8G("ngForOf",o.currencies),t.R7$(6),t.Y8G("ngForOf",o.methodTypes),t.R7$(3),t.JRh(t.bMT(38,29,"profile.visibilityStatus")),t.R7$(4),t.Y8G("ngIf",o.getPaymentGatewayAPIRequirements(o.form.value.type)),t.R7$(),t.Y8G("ngIf",o.getPaymentGatewayAPIRequirements(o.form.value.type)),t.R7$(5),t.Y8G("nzAction",o.root+"upload")("nzHeaders",t.eq3(33,Q,"Bearer "+o.jwt))("nzBeforeUpload",o.beforeUpload)("nzShowUploadList",!1),t.R7$(),t.Y8G("ngIf",!o.avatarUrl),t.R7$(),t.Y8G("ngIf",o.avatarUrl),t.R7$(),t.Y8G("disabled",o.form.invalid),t.R7$(),t.JRh(t.bMT(52,31,"profile.submit")))},dependencies:[T.Sq,T.bT,z.qT,z.me,z.BC,z.cb,z.YS,z.j4,z.JD,B.Sy,s.aO,c.c,l.p,u.Dn,U.Uq,U.e,C.CA,C.Ls,C.Mo,C.zS,O.ld,O.WI,p.WB,p.zR,p.ov,X.$W,N.u,d.D9],encapsulation:2})}return n})();const at=[{path:"",component:V,resolve:{payoutMethods:(n,m)=>{const r=(0,t.WQX)(b.pUR).fetch(),o=(0,t.WQX)(G.xh);return r.subscribe({error:f=>{o.error("This role does not have the permission to access this menu.")}}),r}},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"new",component:S},{path:":id/edit",component:S,resolve:{payoutMethod:(n,m)=>(0,t.WQX)(b.VKT).fetch({id:n.params.id})}}];let it=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=t.$C({type:n});static \u0275inj=t.G2t({imports:[v.iI.forChild(at),v.iI]})}return n})();var lt=a(5885);let st=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=t.$C({type:n});static \u0275inj=t.G2t({imports:[lt.G,it]})}return n})()},6807:(E,j,a)=>{a.d(j,{a:()=>F});var v=a(1360),R=a(2209);let F=(()=>{class g{router;route;constructor(i,s){this.router=i,this.route=s}serializeQueryParams(i,s){const c={};if(c.pageIndex=i.pageIndex,c.pageSize=i.pageSize,null!=i.filter){const l=i.filter.filter(u=>null!=u.value&&u.value.length>0).map(u=>`${u.key}|${Array.isArray(u.value)?"in":"eq"}|${Array.isArray(u.value)?u.value.join("-"):u.value}`);null!=s.filter&&l.push(...s.filter.split(",")),c.filter=l.length>0?l.join(","):void 0}if(null!=i.sort&&i.sort.length>0){const l=i.sort.filter(u=>null!=u.value).map(u=>`${u.key}|${"ascend"==u.value?"ASC":"DESC"}`);null!=s.sort&&l.push(...s.sort.split(",")),c.sort=l.length>0?l.join(","):void 0}return c}onTableQueryParamsChange(i){const s=this.serializeQueryParams(i,this.route.snapshot.queryParams);this.router.navigate([],{relativeTo:this.route,queryParams:s,queryParamsHandling:"merge"})}filterText(i,s){const l=this.deserializeQueryParams(this.route).filter??{};l[i]=null!=s?{like:s}:{};const u=Object.keys(l).map(d=>{if(Object.keys(l[d]).length<1)return null;const h=Object.keys(l[d])[0];return`${d}|${h}|${"in"==h?l[d][h].join("-"):l[d][h]}`}).filter(d=>null!=d),p=u.length>0?u.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:p},queryParamsHandling:"merge"})}filterRange(i,s){const l=this.deserializeQueryParams(this.route).filter??{};l[i]=null!=s?{between:s}:{};const u=Object.keys(l).map(d=>{if(Object.keys(l[d]).length<1)return null;const h=Object.keys(l[d])[0];return`${d}|${h}|${"in"==h||"between"==h?l[d][h].join("-"):l[d][h]}`}).filter(d=>null!=d),p=u.length>0?u.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:p},queryParamsHandling:"merge"})}resetFilter(i,s){this.filterText(i,void 0),s.value=""}downloadURI(i,s){const c=document.createElement("a");c.download=s,c.href=i,c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c)}deserializeQueryParams(i){const s=i.sort?i.sort.split(",").map(p=>({field:p.split("|")[0],direction:p.split("|")[1]})):[],c={};null!=i.filter&&i.filter.split(",").forEach(p=>{const d={},h=p.split("|")[1];if("in"==h){const y=p.split("|")[2].split("-");d[h]=y}else if("between"==h){const y=p.split("|")[2].split("-");d[h]={lower:y[0],upper:y[1]}}else d[h]=p.split("|")[2];c[p.split("|")[0]]=d});const l=null!=i.pageIndex?parseInt(i.pageIndex):1,u=null!=i.pageSize?parseInt(i.pageSize):10;return{sorting:s.length>0?s:void 0,paging:{offset:(l-1)*u,limit:u},filter:null!=c&&Object.keys(c).length>0?c:void 0}}static \u0275fac=function(s){return new(s||g)(v.KVO(R.Ix),v.KVO(R.nX))};static \u0275prov=v.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()}}]);