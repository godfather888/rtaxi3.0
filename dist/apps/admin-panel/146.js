"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[146],{2146:(D,b,o)=>{o.r(b),o.d(b,{ManagementZonePricesModule:()=>ae});var y=o(7624),v=o(3241),e=o(1360);let G=(()=>{class r{gql;constructor(t){this.gql=t}resolve(t,n){return this.gql.fetch()}static \u0275fac=function(n){return new(n||r)(e.KVO(v.wkw))};static \u0275prov=e.jDH({token:r,factory:r.\u0275fac})}return r})();var P=o(467),d=o(9417),C=o(6354),i=o(4843),c=o(2209),p=o(7094),l=o(8434),m=o(1011),g=o(513),u=o(6389),f=o(5930),h=o(7529),M=o(8927),O=o(1997),N=o(2513),R=o(3062),B=o(5703),j=o(2617),Y=o(2047),$=o(3350),Z=o(8852),E=o(8018);const Q=["timeStartPicker"],A=["timeEndPicker"],_=["timeMultiplyInput"],J=["mapFrom"],H=["mapTo"];function U(r,z){if(1&r&&e.nrm(0,"nz-option",39),2&r){const t=z.$implicit;e.Y8G("nzValue",t.id)("nzLabel",t.name)}}function X(r,z){if(1&r&&e.nrm(0,"nz-option",40),2&r){const t=z.$implicit;e.Y8G("nzLabel",t.name)("nzValue",t.id)}}function K(r,z){1&r&&e.EFF(0),2&r&&e.SpI("and ",z.$implicit.length," more selected")}function x(r,z){if(1&r){const t=e.RV6();e.j41(0,"nz-card")(1,"form",19),e.bIt("ngSubmit",function(){e.eBV(t);const a=e.XpG();return e.Njj(a.onSubmit())}),e.nrm(2,"input",20),e.j41(3,"nz-form-item")(4,"nz-form-label",21),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"nz-form-control",22),e.nrm(8,"input",23),e.k0s()(),e.j41(9,"nz-form-item")(10,"nz-form-label",24),e.EFF(11),e.nI1(12,"translate"),e.k0s(),e.j41(13,"nz-form-control")(14,"nz-select",25),e.DNE(15,U,1,2,"nz-option",26),e.k0s()()(),e.j41(16,"nz-form-item",27)(17,"nz-form-label",28),e.EFF(18),e.nI1(19,"translate"),e.k0s(),e.j41(20,"nz-form-control")(21,"nz-select",29),e.DNE(22,X,1,2,"nz-option",30),e.k0s(),e.DNE(23,K,1,1,"ng-template",null,3,e.C5r),e.k0s()(),e.j41(25,"nz-form-item")(26,"nz-form-label",31),e.EFF(27),e.nI1(28,"translate"),e.k0s(),e.j41(29,"nz-form-control"),e.nrm(30,"input",32),e.j41(31,"google-map",33,4),e.nrm(33,"map-polygon",34,5),e.k0s()()(),e.j41(35,"nz-form-item")(36,"nz-form-label",35),e.EFF(37),e.nI1(38,"translate"),e.k0s(),e.j41(39,"nz-form-control"),e.nrm(40,"input",36),e.j41(41,"google-map",33,6),e.nrm(43,"map-polygon",34,5),e.k0s()()(),e.j41(45,"nz-form-item")(46,"nz-form-label",37),e.EFF(47),e.nI1(48,"translate"),e.k0s(),e.j41(49,"nz-form-control"),e.nrm(50,"nz-input-number",38),e.k0s()()()()}if(2&r){const t=z.ngIf,n=e.XpG();e.R7$(),e.Y8G("formGroup",n.form),e.R7$(4),e.JRh(e.bMT(6,15,"profile.name")),e.R7$(6),e.JRh(e.bMT(12,17,"profile.fleet")),e.R7$(4),e.Y8G("ngForOf",t.fleets.nodes),e.R7$(3),e.SpI(" ",e.bMT(19,19,"profile.services")," "),e.R7$(4),e.Y8G("ngForOf",t.services),e.R7$(5),e.JRh(e.bMT(28,21,"zonePrice.pickupAreas")),e.R7$(4),e.Y8G("center",n.center)("zoom",4),e.R7$(2),e.Y8G("paths",null==n.form.value?null:n.form.value.from),e.R7$(4),e.JRh(e.bMT(38,23,"zonePrice.destinationAres")),e.R7$(4),e.Y8G("center",n.center)("zoom",4),e.R7$(2),e.Y8G("paths",null==n.form.value?null:n.form.value.to),e.R7$(4),e.JRh(e.bMT(48,25,"profile.cost"))}}function W(r,z){if(1&r){const t=e.RV6();e.j41(0,"li",41)(1,"span",42)(2,"mark"),e.EFF(3),e.k0s()(),e.j41(4,"ul",43)(5,"nz-list-item-action")(6,"a",44),e.bIt("click",function(){const a=e.eBV(t).$implicit,s=e.XpG();return e.Njj(s.removeTimeRule(a))}),e.EFF(7),e.nI1(8,"translate"),e.k0s()()(),e.EFF(9),e.k0s()}if(2&r){const t=z.$implicit;e.R7$(3),e.SpI("",t.multiply,"x"),e.R7$(4),e.JRh(e.bMT(8,4,"profile.delete")),e.R7$(2),e.Lme(" ",t.startTime," - ",t.endTime," ")}}let k=(()=>{class r{route;router;fb;createGQL;updateGQL;relationsGQL;deleteGQL;msg;query;form;center={lat:24,lng:12};timeStartPicker;timeEndPicker;timeMultiplyInput;timeMultiplyValue=1;mapFrom;mapTo;drawingManagerFrom;drawingManagerTo;polygonsFrom=[];polygonsTo=[];constructor(t,n,a,s,T,I,le,se){this.route=t,this.router=n,this.fb=a,this.createGQL=s,this.updateGQL=T,this.relationsGQL=I,this.deleteGQL=le,this.msg=se,this.form=this.fb.group({id:[null],name:[null,d.k0.required],from:[[]],to:[[]],cost:[null,d.k0.required],fleets:[[]],services:[[]],timeMultipliers:[[]]})}ngOnInit(){this.query=this.route.data.pipe((0,C.T)(t=>t.zonePrice))}ngAfterViewInit(){this.initializeDrawingManager()}initializeDrawingManager(){this.route.data.subscribe(t=>{if(null!=t.zonePrice){const a=t.zonePrice.data.zonePrice;null!=a&&(a.services=a.services.map(s=>s.id),a.fleets=a.fleets.map(s=>s.id),this.form.patchValue(a))}}),this.drawingManagerFrom=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,map:this.mapFrom?.googleMap,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),google.maps.event.addListener(this.drawingManagerFrom,"overlaycomplete",t=>{if(this.polygonsFrom?.push(t.overlay),t.type===google.maps.drawing.OverlayType.POLYGON){const n=t.overlay.getPath().getArray();n.push(n[0]),null==this.form.value.from?this.form.value.from=[n]:(this.form.value.from.push(n),this.form.patchValue({from:this.form.value.from}))}}),this.drawingManagerTo=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,map:this.mapTo?.googleMap,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),google.maps.event.addListener(this.drawingManagerTo,"overlaycomplete",t=>{if(this.polygonsTo?.push(t.overlay),t.type===google.maps.drawing.OverlayType.POLYGON){const n=t.overlay.getPath().getArray();n.push(n[0]),null==this.form.value.to?this.form.value.to=[n]:this.form.value.to.push(n)}})}onSubmit(){var t=this;return(0,P.A)(function*(){try{let{id:n,services:a,fleets:s,...T}=t.form.value;n=null==n?(yield(0,i._)(t.createGQL.mutate({input:T}))).data?.createOneZonePrice.id:(yield(0,i._)(t.updateGQL.mutate({id:n,update:T}))).data?.updateOneZonePrice.id,yield(0,i._)(t.relationsGQL.mutate({id:n,services:a,fleets:s})),t.router.navigate(["management/zone-prices"],{relativeTo:t.route.root})}catch(n){console.log(n),t.msg.error(n.message)}})()}insertTimeRule(){null==this.form.value.timeMultipliers&&(this.form.value.timeMultipliers=[]),this.form.value.timeMultipliers.push({startTime:this.timeStartPicker.inputRef.nativeElement.value,endTime:this.timeEndPicker.inputRef.nativeElement.value,multiply:this.timeMultiplyValue})}removeTimeRule(t){this.form.value.timeMultipliers=this.form.value.timeMultipliers.filter(n=>n!=t)}onDelete(){var t=this;return(0,P.A)(function*(){try{const{id:n}=t.form.value;yield(0,i._)(t.deleteGQL.mutate({id:n})),t.router.navigate(["management/zone-prices"],{relativeTo:t.route.root}),t.msg.success("Zone price deleted successfully")}catch(n){console.error(n)}})()}static \u0275fac=function(n){return new(n||r)(e.rXU(c.nX),e.rXU(c.Ix),e.rXU(d.ze),e.rXU(v.aKb),e.rXU(v.V_9),e.rXU(v.HfJ),e.rXU(v.pn3),e.rXU(p.xh))};static \u0275cmp=e.VBU({type:r,selectors:[["app-zone-price-view"]],viewQuery:function(n,a){if(1&n&&(e.GBs(Q,5),e.GBs(A,5),e.GBs(_,5),e.GBs(J,5),e.GBs(H,5)),2&n){let s;e.mGM(s=e.lsd())&&(a.timeStartPicker=s.first),e.mGM(s=e.lsd())&&(a.timeEndPicker=s.first),e.mGM(s=e.lsd())&&(a.timeMultiplyInput=s.first),e.mGM(s=e.lsd())&&(a.mapFrom=s.first),e.mGM(s=e.lsd())&&(a.mapTo=s.first)}},standalone:!1,decls:40,vars:31,consts:[["timeStartPicker",""],["timeEndPicker",""],["timeMultiplyInput",""],["tagPlaceHolder",""],["mapFrom",""],["poly",""],["mapTo",""],["nzBackIcon","","nzTitle","New Zone price","nzSubtitle","Define regions with static pricing to override the default distance-based calculation",3,"nzGhost"],["style","mt-16",4,"ngIf"],["nzTitle","Time Multiplier",1,"lg:col-span-4","mt-2"],["nz-list","","nzBordered","",3,"nzDataSource"],["nz-list-item","",4,"ngFor","ngForOf"],[1,"md:grid","md:grid-cols-3","md:gap-2","mt-2"],["nzFormat","HH:mm",3,"nzPlaceHolder"],[3,"nzPlaceHolder"],["nz-button","","nzType","primary",1,"float-right",3,"click"],[1,"mt-2","float-right"],["nz-button","","nzType","default","nzDanger","",3,"click"],["nz-button","","nzType","primary",1,"ml-2",3,"click","disabled"],["nz-form","",3,"ngSubmit","formGroup"],["formControlName","id","type","hidden","hidden",""],["nzRequired","","nzFor","name"],["nzErrorTip","The input is not valid name"],["nz-input","","formControlName","name","id","name"],["nzFor","fleet"],["id","fleet","nzMode","multiple","nzPlaceHolder","Please select","formControlName","fleets"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[1,"lg:col-span-4"],["nzRequired",""],["nzMode","multiple","nzPlaceHolder","Please select","formControlName","services"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzFor","from","nzRequired",""],["type","hidden","hidden","","formControlName","from"],["height","400px","width","100%",3,"center","zoom"],[3,"paths"],["nzFor","enabled","nzRequired",""],["type","hidden","hidden","","formControlName","to"],["nzFor","cost","nzRequired",""],["formControlName","cost","id","cost","nzRequired","",1,"w-full"],[3,"nzValue","nzLabel"],[3,"nzLabel","nzValue"],["nz-list-item",""],["nz-typography",""],["nz-list-item-actions",""],[3,"click"]],template:function(n,a){if(1&n){const s=e.RV6();e.nrm(0,"nz-page-header",7),e.DNE(1,x,51,27,"nz-card",8),e.nI1(2,"async"),e.j41(3,"nz-card",9)(4,"ul",10),e.DNE(5,W,10,6,"li",11),e.k0s(),e.j41(6,"div",12)(7,"nz-form-item")(8,"nz-form-label"),e.EFF(9),e.nI1(10,"translate"),e.k0s(),e.j41(11,"nz-form-control"),e.nrm(12,"nz-time-picker",13,0),e.nI1(14,"translate"),e.k0s()(),e.j41(15,"nz-form-item")(16,"nz-form-label"),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"nz-form-control"),e.nrm(20,"nz-time-picker",13,1),e.nI1(22,"translate"),e.k0s()(),e.j41(23,"nz-form-item")(24,"nz-form-label"),e.EFF(25),e.nI1(26,"translate"),e.k0s(),e.j41(27,"nz-form-control"),e.nrm(28,"nz-input-number",14,2),e.nI1(30,"translate"),e.k0s()()(),e.j41(31,"button",15),e.bIt("click",function(){return e.eBV(s),e.Njj(a.insertTimeRule())}),e.EFF(32),e.nI1(33,"translate"),e.k0s()(),e.j41(34,"div",16)(35,"button",17),e.bIt("click",function(){return e.eBV(s),e.Njj(a.onDelete())}),e.EFF(36),e.nI1(37,"translate"),e.k0s(),e.j41(38,"button",18),e.bIt("click",function(){return e.eBV(s),e.Njj(a.onSubmit())}),e.EFF(39,"Save"),e.k0s()()}if(2&n){let s;e.Y8G("nzGhost",!1),e.R7$(),e.Y8G("ngIf",null==(s=e.bMT(2,13,a.query))?null:s.data),e.R7$(3),e.Y8G("nzDataSource",a.form.value.timeMultipliers),e.R7$(),e.Y8G("ngForOf",a.form.value.timeMultipliers),e.R7$(4),e.JRh(e.bMT(10,15,"service.timeMultiplierTable.startTime")),e.R7$(3),e.FS9("nzPlaceHolder",e.bMT(14,17,"service.timeMultiplierTable.startTime")),e.R7$(5),e.JRh(e.bMT(18,19,"service.timeMultiplierTable.endTime")),e.R7$(3),e.FS9("nzPlaceHolder",e.bMT(22,21,"service.timeMultiplierTable.endTime")),e.R7$(5),e.JRh(e.bMT(26,23,"service.timeMultiplierTable.multiplyBy")),e.R7$(3),e.FS9("nzPlaceHolder",e.bMT(30,25,"service.timeMultiplierTable.multiplyBy")),e.R7$(4),e.JRh(e.bMT(33,27,"service.insertRule")),e.R7$(4),e.JRh(e.bMT(37,29,"profile.delete")),e.R7$(2),e.Y8G("disabled",a.form.invalid)}},dependencies:[l.Sq,l.bT,d.qT,d.me,d.BC,d.cb,d.j4,d.JD,m.Sy,g.aO,u.c,f.p,h.Uq,h.e,M.CA,M.Ls,M.Mo,M.zS,O.ld,O.WI,N.zR,R.WB,B.cK,j.eE,j.lQ,j.MV,j.Tc,Y.F,$.u6,$.tc,Z.Di,l.Jj,E.D9],encapsulation:2})}return r})(),V=(()=>{class r{gql;constructor(t){this.gql=t}resolve(t,n){return this.gql.fetch({id:t.params.id})}static \u0275fac=function(n){return new(n||r)(e.KVO(v.z2E))};static \u0275prov=e.jDH({token:r,factory:r.\u0275fac})}return r})();var S=o(2067),w=o(6807),F=o(3359),q=o(1951);function ee(r,z){if(1&r&&(e.j41(0,"tr",7)(1,"td"),e.EFF(2),e.k0s()()),2&r){const t=z.$implicit;e.Y8G("routerLink","view/"+t.id),e.R7$(2),e.JRh(t.name)}}function te(r,z){if(1&r&&(e.j41(0,"nz-table",5,0)(2,"thead")(3,"tr")(4,"th"),e.EFF(5),e.nI1(6,"translate"),e.k0s()()(),e.j41(7,"tbody"),e.DNE(8,ee,3,2,"tr",6),e.k0s()()),2&r){const t=z.ngIf,n=e.sdS(1);e.Y8G("nzFrontPagination",!1)("nzData",t.nodes)("nzTotal",t.totalCount),e.R7$(5),e.JRh(e.bMT(6,5,"profile.name")),e.R7$(3),e.Y8G("ngForOf",n.data)}}let ne=(()=>{class r{route;tableService;tagColor;query;constructor(t,n,a){this.route=t,this.tableService=n,this.tagColor=a}ngOnInit(){this.query=this.route.data.pipe((0,C.T)(t=>t.zonePrices))}static \u0275fac=function(n){return new(n||r)(e.rXU(c.nX),e.rXU(w.a),e.rXU(S.t))};static \u0275cmp=e.VBU({type:r,selectors:[["app-zone-prices-list"]],standalone:!1,decls:11,vars:13,consts:[["ajaxTable",""],["nzBackIcon","",3,"nzGhost","nzTitle","nzSubtitle"],["nz-button","","nzType","primary","routerLink","new"],["nz-icon","","nzType","plus"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal"],["class","group cursor-pointer",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","cursor-pointer",3,"routerLink"]],template:function(n,a){if(1&n&&(e.j41(0,"nz-page-header",1),e.nI1(1,"translate"),e.nI1(2,"translate"),e.j41(3,"nz-page-header-extra")(4,"button",2),e.nrm(5,"i",3),e.EFF(6),e.nI1(7,"translate"),e.k0s()(),e.j41(8,"nz-page-header-content"),e.DNE(9,te,9,7,"nz-table",4),e.nI1(10,"async"),e.k0s()()),2&n){let s;e.Y8G("nzGhost",!1)("nzTitle",e.bMT(1,5,"zonePrices.title"))("nzSubtitle",e.bMT(2,7,"zonePrices.subtitle")),e.R7$(6),e.JRh(e.bMT(7,9,"profile.add")),e.R7$(3),e.Y8G("ngIf",null==(s=e.bMT(10,11,a.query))||null==s.data?null:s.data.zonePrices)}},dependencies:[y.Wk,l.Sq,l.bT,F.CP,F.SO,F._4,F.IL,F.aj,F.kt,g.aO,u.c,f.p,q.Dn,R.WB,R.zR,R.ov,l.Jj,E.D9],encapsulation:2})}return r})(),L=(()=>{class r{paging;gql;constructor(t,n){this.paging=t,this.gql=n}resolve(t,n){const a=this.paging.deserializeQueryParams(t.queryParams);return this.gql.fetch(a)}static \u0275fac=function(n){return new(n||r)(e.KVO(w.a),e.KVO(v.nos))};static \u0275prov=e.jDH({token:r,factory:r.\u0275fac})}return r})();const re=[{path:"",component:ne,resolve:{zonePrices:L},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"view/:id",component:k,resolve:{zonePrice:V}},{path:"new",component:k,resolve:{zonePrice:G}}];let oe=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=e.$C({type:r});static \u0275inj=e.G2t({providers:[V,L,G],imports:[y.iI.forChild(re),y.iI]})}return r})();var ie=o(5885);let ae=(()=>{class r{static \u0275fac=function(n){return new(n||r)};static \u0275mod=e.$C({type:r});static \u0275inj=e.G2t({providers:[S.t],imports:[oe,ie.G]})}return r})()},6807:(D,b,o)=>{o.d(b,{a:()=>e});var y=o(1360),v=o(2209);let e=(()=>{class d{router;route;constructor(i,c){this.router=i,this.route=c}serializeQueryParams(i,c){const p={};if(p.pageIndex=i.pageIndex,p.pageSize=i.pageSize,null!=i.filter){const l=i.filter.filter(m=>null!=m.value&&m.value.length>0).map(m=>`${m.key}|${Array.isArray(m.value)?"in":"eq"}|${Array.isArray(m.value)?m.value.join("-"):m.value}`);null!=c.filter&&l.push(...c.filter.split(",")),p.filter=l.length>0?l.join(","):void 0}if(null!=i.sort&&i.sort.length>0){const l=i.sort.filter(m=>null!=m.value).map(m=>`${m.key}|${"ascend"==m.value?"ASC":"DESC"}`);null!=c.sort&&l.push(...c.sort.split(",")),p.sort=l.length>0?l.join(","):void 0}return p}onTableQueryParamsChange(i){const c=this.serializeQueryParams(i,this.route.snapshot.queryParams);this.router.navigate([],{relativeTo:this.route,queryParams:c,queryParamsHandling:"merge"})}filterText(i,c){const l=this.deserializeQueryParams(this.route).filter??{};l[i]=null!=c?{like:c}:{};const m=Object.keys(l).map(u=>{if(Object.keys(l[u]).length<1)return null;const f=Object.keys(l[u])[0];return`${u}|${f}|${"in"==f?l[u][f].join("-"):l[u][f]}`}).filter(u=>null!=u),g=m.length>0?m.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:g},queryParamsHandling:"merge"})}filterRange(i,c){const l=this.deserializeQueryParams(this.route).filter??{};l[i]=null!=c?{between:c}:{};const m=Object.keys(l).map(u=>{if(Object.keys(l[u]).length<1)return null;const f=Object.keys(l[u])[0];return`${u}|${f}|${"in"==f||"between"==f?l[u][f].join("-"):l[u][f]}`}).filter(u=>null!=u),g=m.length>0?m.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:g},queryParamsHandling:"merge"})}resetFilter(i,c){this.filterText(i,void 0),c.value=""}downloadURI(i,c){const p=document.createElement("a");p.download=c,p.href=i,p.target="_blank",document.body.appendChild(p),p.click(),document.body.removeChild(p)}deserializeQueryParams(i){const c=i.sort?i.sort.split(",").map(g=>({field:g.split("|")[0],direction:g.split("|")[1]})):[],p={};null!=i.filter&&i.filter.split(",").forEach(g=>{const u={},f=g.split("|")[1];if("in"==f){const h=g.split("|")[2].split("-");u[f]=h}else if("between"==f){const h=g.split("|")[2].split("-");u[f]={lower:h[0],upper:h[1]}}else u[f]=g.split("|")[2];p[g.split("|")[0]]=u});const l=null!=i.pageIndex?parseInt(i.pageIndex):1,m=null!=i.pageSize?parseInt(i.pageSize):10;return{sorting:c.length>0?c:void 0,paging:{offset:(l-1)*m,limit:m},filter:null!=p&&Object.keys(p).length>0?p:void 0}}static \u0275fac=function(c){return new(c||d)(y.KVO(v.Ix),y.KVO(v.nX))};static \u0275prov=y.jDH({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()}}]);