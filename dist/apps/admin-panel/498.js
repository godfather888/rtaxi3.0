"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[498],{6807:(B,F,s)=>{s.d(F,{a:()=>D});var P=s(1360),g=s(2209);let D=(()=>{class t{router;route;constructor(l,u){this.router=l,this.route=u}serializeQueryParams(l,u){const _={};if(_.pageIndex=l.pageIndex,_.pageSize=l.pageSize,null!=l.filter){const p=l.filter.filter(d=>null!=d.value&&d.value.length>0).map(d=>`${d.key}|${Array.isArray(d.value)?"in":"eq"}|${Array.isArray(d.value)?d.value.join("-"):d.value}`);null!=u.filter&&p.push(...u.filter.split(",")),_.filter=p.length>0?p.join(","):void 0}if(null!=l.sort&&l.sort.length>0){const p=l.sort.filter(d=>null!=d.value).map(d=>`${d.key}|${"ascend"==d.value?"ASC":"DESC"}`);null!=u.sort&&p.push(...u.sort.split(",")),_.sort=p.length>0?p.join(","):void 0}return _}onTableQueryParamsChange(l){const u=this.serializeQueryParams(l,this.route.snapshot.queryParams);this.router.navigate([],{relativeTo:this.route,queryParams:u,queryParamsHandling:"merge"})}filterText(l,u){const p=this.deserializeQueryParams(this.route).filter??{};p[l]=null!=u?{like:u}:{};const d=Object.keys(p).map(m=>{if(Object.keys(p[m]).length<1)return null;const z=Object.keys(p[m])[0];return`${m}|${z}|${"in"==z?p[m][z].join("-"):p[m][z]}`}).filter(m=>null!=m),f=d.length>0?d.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:f},queryParamsHandling:"merge"})}filterRange(l,u){const p=this.deserializeQueryParams(this.route).filter??{};p[l]=null!=u?{between:u}:{};const d=Object.keys(p).map(m=>{if(Object.keys(p[m]).length<1)return null;const z=Object.keys(p[m])[0];return`${m}|${z}|${"in"==z||"between"==z?p[m][z].join("-"):p[m][z]}`}).filter(m=>null!=m),f=d.length>0?d.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:f},queryParamsHandling:"merge"})}resetFilter(l,u){this.filterText(l,void 0),u.value=""}downloadURI(l,u){const _=document.createElement("a");_.download=u,_.href=l,_.target="_blank",document.body.appendChild(_),_.click(),document.body.removeChild(_)}deserializeQueryParams(l){const u=l.sort?l.sort.split(",").map(f=>({field:f.split("|")[0],direction:f.split("|")[1]})):[],_={};null!=l.filter&&l.filter.split(",").forEach(f=>{const m={},z=f.split("|")[1];if("in"==z){const h=f.split("|")[2].split("-");m[z]=h}else if("between"==z){const h=f.split("|")[2].split("-");m[z]={lower:h[0],upper:h[1]}}else m[z]=f.split("|")[2];_[f.split("|")[0]]=m});const p=null!=l.pageIndex?parseInt(l.pageIndex):1,d=null!=l.pageSize?parseInt(l.pageSize):10;return{sorting:u.length>0?u:void 0,paging:{offset:(p-1)*d,limit:d},filter:null!=_&&Object.keys(_).length>0?_:void 0}}static \u0275fac=function(u){return new(u||t)(P.KVO(g.Ix),P.KVO(g.nX))};static \u0275prov=P.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},8498:(B,F,s)=>{s.r(F),s.d(F,{PayoutsModule:()=>Qt});var P=s(7624),g=s(3241),D=s(8204),b=s(6354),C=s(6807),t=s(1360),j=s(2209),l=s(8434),u=s(3359),_=s(1868),p=s(2602),d=s(513),f=s(6389),m=s(5930),z=s(1951),h=s(7529),V=s(5699),v=s(3062),x=s(6677),w=s(2560),E=s(8018),O=s(3409);const U=()=>({height:100,width:500});function Q(e,i){if(1&e){const n=t.RV6();t.j41(0,"li",17),t.bIt("click",function(){const o=t.eBV(n).$implicit,r=t.XpG(2);return t.Njj(r.changeCurrency(o))}),t.EFF(1),t.k0s()}if(2&e){const n=i.$implicit;t.R7$(),t.SpI(" ",n," ")}}function L(e,i){if(1&e){const n=t.RV6();t.j41(0,"div",18),t.bIt("nzChartInitialized",function(o){t.eBV(n);const r=t.XpG(2);return t.Njj(r.onChartPayoutMethodsInit(o))}),t.k0s()}2&e&&t.Y8G("nzChartOptions",t.lJ4(1,U))}function H(e,i){if(1&e&&(t.j41(0,"nz-tag",23),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","blue")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function J(e,i){if(1&e&&(t.j41(0,"nz-tag",23),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","green")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function W(e,i){if(1&e&&(t.j41(0,"nz-tag",23),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","red")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function q(e,i){if(1&e&&(t.j41(0,"nz-tag",23),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","default")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function K(e,i){if(1&e&&(t.j41(0,"tr",21)(1,"td"),t.EFF(2),t.nI1(3,"timeago"),t.k0s(),t.j41(4,"td"),t.EFF(5),t.nI1(6,"currency"),t.k0s(),t.j41(7,"td"),t.DNE(8,H,2,3,"nz-tag",22)(9,J,2,3,"nz-tag",22)(10,W,2,3,"nz-tag",22)(11,q,2,3,"nz-tag",22),t.k0s()()),2&e){const n=i.$implicit,a=t.XpG(3);t.Y8G("routerLink",n.id+"/view"),t.R7$(2),t.SpI(" ",t.bMT(3,7,n.createdAt)," "),t.R7$(3),t.SpI(" ",t.i5U(6,9,n.totalAmount,n.currency)," "),t.R7$(3),t.Y8G("ngIf",n.status===a.sessionStatus.Pending),t.R7$(),t.Y8G("ngIf",n.status===a.sessionStatus.Paid),t.R7$(),t.Y8G("ngIf",n.status===a.sessionStatus.Failed),t.R7$(),t.Y8G("ngIf",n.status===a.sessionStatus.Cancelled)}}function Z(e,i){if(1&e){const n=t.RV6();t.j41(0,"nz-table",19,2),t.bIt("nzQueryParams",function(o){t.eBV(n);const r=t.XpG(2);return t.Njj(r.tableService.onTableQueryParamsChange(o))}),t.j41(2,"thead")(3,"tr")(4,"th"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"th"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"th"),t.EFF(11),t.nI1(12,"translate"),t.k0s()()(),t.j41(13,"tbody"),t.DNE(14,K,12,12,"tr",20),t.k0s()()}if(2&e){const n=i.ngIf,a=t.sdS(1);t.Y8G("nzFrontPagination",!1)("nzData",n.nodes)("nzTotal",n.totalCount),t.R7$(5),t.SpI(" ",t.bMT(6,7,"profile.createdAt")," "),t.R7$(3),t.SpI(" ",t.bMT(9,9,"profile.totalAmount")," "),t.R7$(3),t.SpI(" ",t.bMT(12,11,"profile.status")," "),t.R7$(3),t.Y8G("ngForOf",a.data)}}function tt(e,i){if(1&e&&(t.j41(0,"nz-page-header",4)(1,"nz-page-header-extra")(2,"span",5)(3,"button",6),t.EFF(4,"Actions"),t.nrm(5,"span",7),t.k0s(),t.j41(6,"nz-dropdown-menu",null,0)(8,"ul",8)(9,"li",9),t.EFF(10,"New Payout Session"),t.k0s(),t.j41(11,"li",10)(12,"ul"),t.DNE(13,Q,2,1,"li",11),t.k0s()()()()()(),t.j41(14,"nz-page-header-content")(15,"nz-row",12),t.nrm(16,"nz-statistic",13),t.nI1(17,"currency"),t.nrm(18,"nz-statistic",14),t.nI1(19,"currency"),t.nrm(20,"nz-statistic",15),t.DNE(21,L,1,2,"ng-template",null,1,t.C5r),t.k0s(),t.DNE(23,Z,15,13,"nz-table",16),t.k0s()()),2&e){let n,a;const o=i.ngIf,r=t.sdS(7),c=t.sdS(22);t.Y8G("nzGhost",!1),t.R7$(3),t.Y8G("nzDropdownMenu",r)("nzPlacement","bottomRight"),t.R7$(10),t.Y8G("ngForOf",o.supportedCurrencies),t.R7$(3),t.Y8G("nzValue",null!==(n=t.i5U(17,8,o.taxiPayoutStatistics.pendingAmount,o.taxiPayoutStatistics.currency))&&void 0!==n?n:"N/A"),t.R7$(2),t.Y8G("nzValue",null!==(a=t.i5U(19,11,o.taxiPayoutStatistics.lastPayoutAmount,o.taxiPayoutStatistics.currency))&&void 0!==a?a:"N/A"),t.R7$(2),t.Y8G("nzValueTemplate",c),t.R7$(3),t.Y8G("ngIf",o.taxiPayoutSessions)}}let nt=(()=>{class e{route;router;tableService;query;serverUrl=D.c.root;sessionStatus=g.lhR;chartPayoutMethods;constructor(n,a,o){this.route=n,this.router=a,this.tableService=o}ngOnInit(){this.query=this.route.data.pipe((0,b.T)(n=>n.payouts))}onChartPayoutMethodsInit(n){this.chartPayoutMethods=n,this.query?.subscribe(a=>{const r=a.data.taxiPayoutStatistics.usersDefaultPayoutMethodStats.map(c=>({count:c.totalCount,name:c.payoutMethod?.name??"Without payout method"}));this.chartPayoutMethods.data(r).interval().position("count").color("name").adjust("stack"),this.chartPayoutMethods.coordinate("rect").transpose(),this.chartPayoutMethods.render()})}refreshPayoutsChart(){}changeCurrency(n){this.router.navigate([],{queryParams:{currency:n},queryParamsHandling:"merge"})}static \u0275fac=function(a){return new(a||e)(t.rXU(j.nX),t.rXU(j.Ix),t.rXU(C.a))};static \u0275cmp=t.VBU({type:e,selectors:[["app-payouts"]],standalone:!1,decls:2,vars:3,consts:[["menu","nzDropdownMenu"],["payoutMethodTemplate",""],["table",""],["nzBackIcon","","nzTitle","Payouts","nzSubtitle","Manage and track payouts for service providers",3,"nzGhost",4,"ngIf"],["nzBackIcon","","nzTitle","Payouts","nzSubtitle","Manage and track payouts for service providers",3,"nzGhost"],[1,"header-trigger",2,"margin-right","15px"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzPlacement"],["nz-icon","","nzType","down"],["nz-menu",""],["nz-menu-item","","routerLink","./new"],["nz-submenu","","nzTitle","Change currency"],["nz-menu-item","",3,"click",4,"ngFor","ngForOf"],["nzType","flex",1,"mb-4"],["nzTitle","Pending",3,"nzValue"],["nzTitle","Last Payout",2,"margin","0 32px",3,"nzValue"],["nzTitle","Payout Methods",2,"margin","0 32px",3,"nzValueTemplate"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-g2","",3,"nzChartInitialized","nzChartOptions"],["nzShowSizeChanger","","nzBordered","",3,"nzQueryParams","nzFrontPagination","nzData","nzTotal"],["class","group cursor-pointer",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","cursor-pointer",3,"routerLink"],[3,"nzColor","nzBordered",4,"ngIf"],[3,"nzColor","nzBordered"]],template:function(a,o){if(1&a&&(t.DNE(0,tt,24,14,"nz-page-header",3),t.nI1(1,"async")),2&a){let r;t.Y8G("ngIf",null==(r=t.bMT(1,1,o.query))?null:r.data)}},dependencies:[l.Sq,l.bT,u.CP,u.SO,u._4,u.IL,u.aj,u.kt,_.jS,_.CU,_.Nu,p.j3,p.wQ,p.h4,d.aO,f.c,m.p,z.Dn,h.e,V.s,v.WB,v.zR,v.ov,x.IV,w.j,P.Wk,l.Jj,l.oe,E.D9,O.PZ],encapsulation:2})}return e})();var R=s(7094),G=s(467),y=s(9417),I=s(4843),M=s(712),A=s(1011),T=s(8927),Y=s(1997),at=s(1166);function ot(e,i){if(1&e&&t.nrm(0,"nz-option",14),2&e){const n=i.$implicit;t.Y8G("nzLabel",n)("nzValue",n)}}function it(e,i){if(1&e&&t.nrm(0,"nz-option",14),2&e){const n=i.$implicit;t.Y8G("nzLabel",n.name)("nzValue",n.id)}}function rt(e,i){if(1&e){const n=t.RV6();t.j41(0,"nz-page-header-content")(1,"form",3),t.bIt("ngSubmit",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.submitForm())}),t.j41(2,"nz-form-item")(3,"nz-form-label",4),t.EFF(4,"Minimum Amount"),t.k0s(),t.j41(5,"nz-form-control"),t.nrm(6,"nz-slider",5),t.k0s()(),t.j41(7,"nz-form-item")(8,"nz-form-label",6),t.EFF(9,"Currency"),t.k0s(),t.j41(10,"nz-form-control",7)(11,"nz-select",8),t.DNE(12,ot,1,2,"nz-option",9),t.k0s()()(),t.j41(13,"nz-form-item")(14,"nz-form-label",10),t.EFF(15,"Payout Methods"),t.k0s(),t.j41(16,"nz-form-control")(17,"nz-select",11),t.DNE(18,it,1,2,"nz-option",9),t.k0s()()(),t.j41(19,"nz-form-item")(20,"nz-form-label",12),t.EFF(21,"Description"),t.k0s(),t.j41(22,"nz-form-control"),t.nrm(23,"textarea",13),t.k0s()()()()}if(2&e){const n=i.ngIf,a=t.XpG();t.R7$(),t.Y8G("formGroup",a.form),t.R7$(11),t.Y8G("ngForOf",n.data.supportedCurrencies),t.R7$(6),t.Y8G("ngForOf",n.data.payoutMethods.nodes)}}let st=(()=>{class e{fb;createGQL;routerHelper;route;msg;constructor(n,a,o,r,c){this.fb=n,this.createGQL=a,this.routerHelper=o,this.route=r,this.msg=c,this.form=this.fb.group({minimumAmount:[0,y.k0.required],currency:[null,y.k0.required],payoutMethodIds:[[],y.k0.required],description:[null,y.k0.required]}),this.query=this.route.data.pipe((0,b.T)(S=>S.fields))}form;query;submitForm(){var n=this;return(0,G.A)(function*(){try{yield(0,I._)(n.createGQL.mutate({input:{...n.form.value,appType:g.uCV.Taxi}})),n.routerHelper.goToParent(n.route)}catch(a){n.msg.error(a.message),console.log(JSON.stringify(a))}})()}static \u0275fac=function(a){return new(a||e)(t.rXU(y.ok),t.rXU(g.JLw),t.rXU(M.T),t.rXU(j.nX),t.rXU(R.xh))};static \u0275cmp=t.VBU({type:e,selectors:[["app-create-payout-session"]],standalone:!1,decls:6,vars:4,consts:[["nzBackIcon","","nzTitle","New Payout session","nzSubtitle","Create a payout session using filters below",1,"max-w-2xl",2,"margin","auto",3,"nzGhost"],["nz-button","","nzType","primary",3,"click"],[4,"ngIf"],["nz-form","",3,"ngSubmit","formGroup"],["nzRequired","","nzFor","minimumAmount"],["nzMin","0","nzMax","10000","formControlName","minimumAmount"],["nzFor","currency","nzRequired",""],["required",""],["formControlName","currency",1,"phone-select"],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzFor","payoutMethodIds","nzRequired",""],["formControlName","payoutMethodIds","nzMode","multiple","nzPlaceHolder","Please select at least one","required",""],["nzFor","description"],["nz-input","","formControlName","description","id","description","rows","4"],[3,"nzLabel","nzValue"]],template:function(a,o){1&a&&(t.j41(0,"nz-page-header",0)(1,"nz-page-header-extra")(2,"button",1),t.bIt("click",function(){return o.submitForm()}),t.EFF(3,"Create"),t.k0s()(),t.DNE(4,rt,24,3,"nz-page-header-content",2),t.nI1(5,"async"),t.k0s()),2&a&&(t.Y8G("nzGhost",!1),t.R7$(4),t.Y8G("ngIf",t.bMT(5,2,o.query)))},dependencies:[l.Sq,l.bT,y.qT,y.me,y.BC,y.cb,y.YS,y.j4,y.JD,A.Sy,d.aO,f.c,m.p,h.Uq,h.e,T.CA,T.Ls,T.Mo,T.zS,Y.ld,Y.WI,v.WB,v.zR,v.ov,at.pT,l.Jj],encapsulation:2})}return e})();var ut=s(2983),N=s(2e3),ct=s(9438),pt=s(5703),dt=s(5154),X=s(7685),$=s(6501),_t=s(8852);function mt(e,i){if(1&e&&t.nrm(0,"nz-avatar",24),2&e){const n=t.XpG().$implicit,a=t.XpG(2);t.Y8G("nzSrc",a.serverUrl+n.media.address)}}function zt(e,i){if(1&e){const n=t.RV6();t.j41(0,"button",26),t.bIt("click",function(){t.eBV(n);const o=t.XpG(2).$implicit,r=t.XpG(2);return t.Njj(r.exportToCSV(o.id))}),t.EFF(1,"Export to CSV"),t.k0s()}if(2&e){const n=t.XpG(2).$implicit,a=t.XpG().ngIf,o=t.XpG();t.Y8G("disabled",0==o.getAmountToBePaid(a.amountToBePaidByPayoutMethod,n.id))}}function gt(e,i){1&e&&(t.j41(0,"nz-space"),t.DNE(1,zt,2,1,"button",25),t.k0s())}function yt(e,i){1&e&&(t.j41(0,"button",29),t.EFF(1,"Add balance"),t.k0s())}function ft(e,i){if(1&e){const n=t.RV6();t.j41(0,"button",30),t.bIt("click",function(){t.eBV(n);const o=t.XpG(2).$implicit,r=t.XpG(2);return t.Njj(r.payoutStripe(o.id))}),t.EFF(1,"Payout"),t.k0s()}if(2&e){let n,a;const o=t.XpG(2).$implicit,r=t.XpG().ngIf,c=t.XpG();t.Y8G("nz-tooltip",c.getAmountToBePaid(r.amountToBePaidByPayoutMethod,o.id)>(null!==(n=o.balance)&&void 0!==n?n:0)?"Insufficient balance":"")("disabled",c.getAmountToBePaid(r.amountToBePaidByPayoutMethod,o.id)>(null!==(a=o.balance)&&void 0!==a?a:0)||0==c.getAmountToBePaid(r.amountToBePaidByPayoutMethod,o.id))}}function ht(e,i){1&e&&(t.j41(0,"nz-space"),t.DNE(1,yt,2,0,"button",27)(2,ft,2,2,"button",28),t.k0s())}function vt(e,i){if(1&e&&(t.j41(0,"nz-descriptions-item",31),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(),t.JRh(t.i5U(2,1,n.balance,n.currency))}}function St(e,i){if(1&e&&(t.j41(0,"div",17)(1,"nz-card",18)(2,"nz-page-header"),t.DNE(3,mt,1,1,"nz-avatar",19),t.j41(4,"nz-page-header-title"),t.EFF(5),t.k0s(),t.j41(6,"nz-page-header-extra"),t.DNE(7,gt,2,0,"nz-space",7)(8,ht,3,0,"nz-space",7),t.k0s(),t.j41(9,"nz-page-header-content")(10,"p",20),t.EFF(11),t.k0s(),t.j41(12,"nz-descriptions",21),t.DNE(13,vt,3,4,"nz-descriptions-item",22),t.j41(14,"nz-descriptions-item",23),t.EFF(15),t.nI1(16,"currency"),t.k0s()()()()()()),2&e){const n=i.$implicit,a=t.XpG().ngIf,o=t.XpG();t.R7$(3),t.Y8G("ngIf",null!=n.media),t.R7$(2),t.JRh(n.name),t.R7$(2),t.Y8G("ngIf",n.type==o.payoutMethodType.BankTransfer),t.R7$(),t.Y8G("ngIf",n.type==o.payoutMethodType.Stripe),t.R7$(3),t.SpI(" ",n.description," "),t.R7$(),t.Y8G("nzColumn",2),t.R7$(),t.Y8G("ngIf",n.balance),t.R7$(2),t.JRh(t.i5U(16,8,o.getAmountToBePaid(a.amountToBePaidByPayoutMethod,n.id),n.currency))}}function Pt(e,i){if(1&e&&t.nrm(0,"nz-avatar",39),2&e){const n=t.XpG().$implicit,a=t.XpG(3);t.Y8G("nzSrc",a.serverUrl+n.driver.media.address)}}function Tt(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","processing")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function Ct(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","success")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function bt(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","error")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function Gt(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG().$implicit;t.Y8G("nzColor","default")("nzBordered",!1),t.R7$(),t.JRh(n.status)}}function It(e,i){if(1&e){const n=t.RV6();t.j41(0,"tr",34),t.bIt("click",function(){const o=t.eBV(n).$implicit,r=t.XpG(3);return t.Njj(r.showPayoutDialog(o))}),t.j41(1,"td")(2,"div",35),t.DNE(3,Pt,1,1,"nz-avatar",36),t.j41(4,"span",37),t.EFF(5),t.k0s()()(),t.j41(6,"td"),t.EFF(7),t.nI1(8,"currency"),t.k0s(),t.j41(9,"td"),t.DNE(10,Tt,2,3,"nz-tag",38)(11,Ct,2,3,"nz-tag",38)(12,bt,2,3,"nz-tag",38)(13,Gt,2,3,"nz-tag",38),t.k0s()()}if(2&e){const n=i.$implicit,a=t.XpG(3);t.R7$(3),t.Y8G("ngIf",null!=(null==n.driver?null:n.driver.media)),t.R7$(2),t.Lme("",null==n.driver?null:n.driver.firstName," ",null==n.driver?null:n.driver.lastName,""),t.R7$(2),t.SpI(" ",t.i5U(8,8,n.amount,n.currency)," "),t.R7$(3),t.Y8G("ngIf",n.status==a.transactionStatus.Processing),t.R7$(),t.Y8G("ngIf",n.status==a.transactionStatus.Done),t.R7$(),t.Y8G("ngIf",n.status==a.transactionStatus.Rejected),t.R7$(),t.Y8G("ngIf",n.status==a.transactionStatus.Canceled)}}function Ft(e,i){if(1&e){const n=t.RV6();t.j41(0,"nz-table",32,1),t.bIt("nzQueryParams",function(o){t.eBV(n);const r=t.XpG(2);return t.Njj(r.tableService.onTableQueryParamsChange(o))}),t.j41(2,"thead")(3,"tr")(4,"th"),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"th"),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"th"),t.EFF(11),t.nI1(12,"translate"),t.k0s()()(),t.j41(13,"tbody"),t.DNE(14,It,14,11,"tr",33),t.k0s()()}if(2&e){const n=i.ngIf,a=t.sdS(1);t.Y8G("nzFrontPagination",!1)("nzData",n)("nzTotal",n.length),t.R7$(5),t.SpI(" ",t.bMT(6,7,"profile.driver")," "),t.R7$(3),t.SpI(" ",t.bMT(9,9,"profile.amount")," "),t.R7$(3),t.SpI(" ",t.bMT(12,11,"profile.status")," "),t.R7$(3),t.Y8G("ngForOf",a.data)}}function Dt(e,i){if(1&e&&(t.j41(0,"nz-page-header-content")(1,"nz-row",11),t.nrm(2,"nz-statistic",12),t.nI1(3,"currency"),t.nrm(4,"nz-statistic",13),t.nI1(5,"currency"),t.nrm(6,"nz-statistic",14),t.nI1(7,"currency"),t.k0s(),t.DNE(8,St,17,11,"div",15)(9,Ft,15,13,"nz-table",16),t.nI1(10,"async"),t.k0s()),2&e){let n,a,o,r;const c=i.ngIf,S=t.XpG();t.R7$(2),t.Y8G("nzValue",null!==(n=t.i5U(3,5,c.totalAmount,c.currency))&&void 0!==n?n:"N/A"),t.R7$(2),t.Y8G("nzValue",null!==(a=t.i5U(5,8,null==c.paidAmount[0].sum?null:c.paidAmount[0].sum.amount,c.currency))&&void 0!==a?a:"N/A"),t.R7$(2),t.Y8G("nzValue",null!==(o=t.i5U(7,11,null==c.unpaidAmount[0].sum?null:c.unpaidAmount[0].sum.amount,c.currency))&&void 0!==o?o:"N/A"),t.R7$(2),t.Y8G("ngForOf",c.payoutMethods),t.R7$(),t.Y8G("ngIf",null==(r=t.bMT(10,14,S.transactions))||null==r.data||null==r.data.taxiPayoutSession||null==r.data.taxiPayoutSession.driverTransactions?null:r.data.taxiPayoutSession.driverTransactions.nodes)}}function jt(e,i){if(1&e&&t.nrm(0,"nz-avatar",24),2&e){const n=t.XpG().ngIf,a=t.XpG(2);t.Y8G("nzSrc",a.serverUrl+(null==n[0].payoutMethod.media?null:n[0].payoutMethod.media.address))}}function Rt(e,i){if(1&e&&(t.j41(0,"div",35),t.DNE(1,jt,1,1,"nz-avatar",19),t.j41(2,"span",37),t.EFF(3),t.k0s()()),2&e){const n=i.ngIf;t.R7$(),t.Y8G("ngIf",null==n[0].payoutMethod||null==n[0].payoutMethod.media?null:n[0].payoutMethod.media.address),t.R7$(2),t.JRh(n[0].payoutMethod.name)}}function $t(e,i){if(1&e&&(t.j41(0,"div"),t.DNE(1,Rt,4,2,"div",41),t.k0s()),2&e){const n=t.XpG();t.R7$(),t.Y8G("ngIf",null==n.payoutDialogData||null==n.payoutDialogData.driver||null==n.payoutDialogData.driver.payoutAccounts?null:n.payoutDialogData.driver.payoutAccounts.nodes)}}function kt(e,i){1&e&&t.nrm(0,"nz-spin",43)}function Vt(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG(3);t.Y8G("nzColor","processing")("nzBordered",!1),t.R7$(),t.JRh(null==n.payoutDialogData?null:n.payoutDialogData.status)}}function xt(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG(3);t.Y8G("nzColor","success")("nzBordered",!1),t.R7$(),t.JRh(null==n.payoutDialogData?null:n.payoutDialogData.status)}}function Et(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG(3);t.Y8G("nzColor","error")("nzBordered",!1),t.R7$(),t.JRh(null==n.payoutDialogData?null:n.payoutDialogData.status)}}function Mt(e,i){if(1&e&&(t.j41(0,"nz-tag",40),t.EFF(1),t.k0s()),2&e){const n=t.XpG(3);t.Y8G("nzColor","default")("nzBordered",!1),t.R7$(),t.JRh(null==n.payoutDialogData?null:n.payoutDialogData.status)}}function At(e,i){if(1&e&&(t.j41(0,"nz-descriptions",44)(1,"nz-descriptions-item",49),t.EFF(2),t.k0s(),t.j41(3,"nz-descriptions-item",50),t.EFF(4),t.k0s(),t.j41(5,"nz-descriptions-item",51),t.EFF(6),t.k0s(),t.j41(7,"nz-descriptions-item",52),t.EFF(8),t.k0s(),t.j41(9,"nz-descriptions-item",53),t.EFF(10),t.k0s(),t.j41(11,"nz-descriptions-item",54),t.EFF(12),t.k0s(),t.j41(13,"nz-descriptions-item",55),t.EFF(14),t.k0s(),t.j41(15,"nz-descriptions-item",56),t.EFF(16),t.k0s(),t.j41(17,"nz-descriptions-item",57),t.EFF(18),t.k0s(),t.j41(19,"nz-descriptions-item",58),t.EFF(20),t.k0s()()),2&e){const n=i.ngIf;t.Y8G("nzColumn",1),t.R7$(2),t.SpI(" ",null==n?null:n.name," "),t.R7$(2),t.SpI(" ",null==n?null:n.accountNumber," "),t.R7$(2),t.SpI(" ",null==n?null:n.routingNumber," "),t.R7$(2),t.SpI(" ",null==n?null:n.bankName," "),t.R7$(2),t.SpI(" ",null==n?null:n.branchName," "),t.R7$(2),t.SpI(" ",null==n?null:n.accountHolderName," "),t.R7$(2),t.SpI(" ",null==n?null:n.accountHolderCountry," "),t.R7$(2),t.SpI(" ",null==n?null:n.accountHolderState," "),t.R7$(2),t.SpI(" ",null==n?null:n.accountHolderCity," "),t.R7$(2),t.SpI(" ",null==n?null:n.accountHolderAddress," ")}}function Yt(e,i){if(1&e&&(t.j41(0,"div"),t.DNE(1,At,21,11,"nz-descriptions",48),t.k0s()),2&e){const n=i.ngIf;t.R7$(),t.Y8G("ngIf",n[0])}}function Nt(e,i){if(1&e&&(t.j41(0,"form",59)(1,"nz-form-item")(2,"nz-form-label",60),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"nz-form-control"),t.nrm(6,"input",61),t.k0s()(),t.j41(7,"nz-form-item")(8,"nz-form-label",62),t.EFF(9,"Description"),t.k0s(),t.j41(10,"nz-form-control"),t.nrm(11,"textarea",63),t.k0s()()()),2&e){const n=t.XpG(3);t.Y8G("formGroup",n.formGroupManualPayout),t.R7$(3),t.JRh(t.bMT(4,2,"profile.transactionNumber"))}}function Xt(e,i){if(1&e&&(t.j41(0,"div")(1,"nz-descriptions",44)(2,"nz-descriptions-item",45),t.EFF(3),t.nI1(4,"currency"),t.k0s(),t.j41(5,"nz-descriptions-item",46),t.DNE(6,Vt,2,3,"nz-tag",38)(7,xt,2,3,"nz-tag",38)(8,Et,2,3,"nz-tag",38)(9,Mt,2,3,"nz-tag",38),t.k0s()(),t.DNE(10,Yt,2,1,"div",7)(11,Nt,12,4,"form",47),t.k0s()),2&e){const n=t.XpG(2);t.R7$(),t.Y8G("nzColumn",1),t.R7$(2),t.JRh(t.i5U(4,8,null==n.payoutDialogData?null:n.payoutDialogData.amount,null==n.payoutDialogData?null:n.payoutDialogData.currency)),t.R7$(3),t.Y8G("ngIf",(null==n.payoutDialogData?null:n.payoutDialogData.status)==n.transactionStatus.Processing),t.R7$(),t.Y8G("ngIf",(null==n.payoutDialogData?null:n.payoutDialogData.status)==n.transactionStatus.Done),t.R7$(),t.Y8G("ngIf",(null==n.payoutDialogData?null:n.payoutDialogData.status)==n.transactionStatus.Rejected),t.R7$(),t.Y8G("ngIf",(null==n.payoutDialogData?null:n.payoutDialogData.status)==n.transactionStatus.Canceled),t.R7$(),t.Y8G("ngIf",null==n.payoutDialogData||null==n.payoutDialogData.driver||null==n.payoutDialogData.driver.payoutAccounts?null:n.payoutDialogData.driver.payoutAccounts.nodes),t.R7$(),t.Y8G("ngIf",(null==n.payoutDialogData?null:n.payoutDialogData.status)!=n.transactionStatus.Done)}}function Bt(e,i){if(1&e&&(t.j41(0,"div"),t.DNE(1,kt,1,0,"nz-spin",42)(2,Xt,12,11,"div",7),t.k0s()),2&e){const n=t.XpG();t.R7$(),t.Y8G("ngIf",n.payoutDialogLoading),t.R7$(),t.Y8G("ngIf",!n.payoutDialogLoading)}}const wt=[{path:"",component:nt,resolve:{payouts:(e,i)=>{const n=(0,t.WQX)(C.a),a=(0,t.WQX)(g.qGp),o=n.deserializeQueryParams(e.queryParams),r=a.fetch({sessionsPaging:o.paging,currency:e.queryParams.currency}),c=(0,t.WQX)(R.xh);return r.subscribe({error:S=>{c.error("This role does not have sufficient permission to access this menu.")}}),r}},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"new",component:st,resolve:{fields:(e,i)=>((0,t.WQX)(C.a),(0,t.WQX)(g.c$9).fetch())},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:":id/view",component:(()=>{class e{fb;tableService;route;routerHelper;messageService;runAutoPayoutGql;exportToCsvGql;saveManualPayoutGql;updatePayoutSessionStatusGql;id;constructor(n,a,o,r,c,S,Lt,Ht,Jt){this.fb=n,this.tableService=a,this.route=o,this.routerHelper=r,this.messageService=c,this.runAutoPayoutGql=S,this.exportToCsvGql=Lt,this.saveManualPayoutGql=Ht,this.updatePayoutSessionStatusGql=Jt,this.id=this.route.snapshot.params.id,this.formGroupManualPayout=this.fb.group({transactionNumber:["",y.k0.required],description:[null]}),this.transactions=this.route.data.pipe((0,b.T)(k=>k.transactions)),this.query=this.route.data.pipe((0,b.T)(k=>k.payoutSession))}serverUrl=D.c.root;formGroupManualPayout;query;transactions;transactionStatus=g.x8r;payoutMethodType=g.UCp;payoutSessionStatus=g.lhR;manualPayoutDialog;payoutDialogVisible=!1;payoutDialogLoading=!1;payoutDialogData;getImageUrl(n){if(!n)return;const a=n.replace(/^\/+/,"");return this.serverUrl+a}exportToCSV(n){var a=this;return(0,G.A)(function*(){try{const o=yield(0,I._)(a.exportToCsvGql.mutate({input:{payoutSessionId:a.id,payoutMethodId:n}}));window.open(a.serverUrl+o.data?.exportTaxiPayoutSessionToCsv)}catch(o){a.messageService.error(o.message)}})()}getAmountToBePaid(n,a){return n.find(o=>o.groupBy?.payoutMethodId==a)?.sum?.amount??0}payoutStripe(n){var a=this;return(0,G.A)(function*(){try{yield(0,I._)(a.runAutoPayoutGql.mutate({input:{payoutSessionId:a.id,payoutMethodId:n}})),a.routerHelper.refresh(a.route),a.messageService.success("Payout completed successfully")}catch(o){a.messageService.error(o.message)}})()}showPayoutDialog(n){this.payoutDialogData=n,this.payoutDialogVisible=!0}saveManualPayout(n){var a=this;return(0,G.A)(function*(){try{a.payoutDialogLoading=!0,yield(0,I._)(a.saveManualPayoutGql.mutate({input:{appType:g.uCV.Taxi,userTransactionId:n,transactionNumber:a.formGroupManualPayout.value.transactionNumber,description:a.formGroupManualPayout.value.description}})),a.routerHelper.refresh(a.route),a.messageService.success("Payout completed successfully"),a.payoutDialogLoading=!1,a.payoutDialogVisible=!1}catch(o){a.messageService.error(o.message)}})()}changeStatus(n){var a=this;return(0,G.A)(function*(){try{yield(0,I._)(a.updatePayoutSessionStatusGql.mutate({id:a.id,update:{status:n}})),a.routerHelper.refresh(a.route),a.messageService.success("Payout status changed successfully")}catch(o){a.messageService.error(o.message)}})()}static \u0275fac=function(a){return new(a||e)(t.rXU(y.ok),t.rXU(C.a),t.rXU(j.nX),t.rXU(M.T),t.rXU(R.xh),t.rXU(g.JyU),t.rXU(g.McD),t.rXU(g.r3Z),t.rXU(g.o8H))};static \u0275cmp=t.VBU({type:e,selectors:[["app-view-payout-session"]],standalone:!1,decls:23,vars:13,consts:[["menu4","nzDropdownMenu"],["table",""],["nzBackIcon","","nzSubtitle","Create a payout session using filters below",1,"max-w-2xl",2,"margin","auto",3,"nzGhost","nzTitle"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu"],["nz-icon","","nzType","down"],["nz-menu",""],["nz-menu-item","",3,"click"],[4,"ngIf"],["nzOkText","Save Payout information",3,"nzVisibleChange","nzOnCancel","nzOnOk","nzVisible","nzOkDisabled","nzOkLoading"],[4,"nzModalTitle"],[4,"nzModalContent"],["nzType","flex",1,"mb-4"],["nzTitle","Total Amount",3,"nzValue"],["nzTitle","Paid Amount",2,"margin","0 32px",3,"nzValue"],["nzTitle","Unpaid Amount",2,"margin","0 32px",3,"nzValue"],["class"," mb-4",4,"ngFor","ngForOf"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],[1,"mb-4"],["nzSize","small"],["nz-page-header-avatar","",3,"nzSrc",4,"ngIf"],["nz-paragraph",""],["nzSize","small",3,"nzColumn"],["nzTitle","Account Balance",4,"ngIf"],["nzTitle","Amount to be paid"],["nz-page-header-avatar","",3,"nzSrc"],["nz-button","","nzType","primary",3,"disabled","click",4,"nzSpaceItem"],["nz-button","","nzType","primary",3,"click","disabled"],["nz-button","","routerLink","https://dashboard.stripe.com/balance/overview",4,"nzSpaceItem"],["nz-button","","nzType","primary",3,"nz-tooltip","disabled","click",4,"nzSpaceItem"],["nz-button","","routerLink","https://dashboard.stripe.com/balance/overview"],["nz-button","","nzType","primary",3,"click","nz-tooltip","disabled"],["nzTitle","Account Balance"],["nzShowSizeChanger","","nzBordered","",3,"nzQueryParams","nzFrontPagination","nzData","nzTotal"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[1,"flex","flex-row","items-center"],[3,"nzSrc",4,"ngIf"],[1,"ml-2"],[3,"nzColor","nzBordered",4,"ngIf"],[3,"nzSrc"],[3,"nzColor","nzBordered"],["class","flex flex-row items-center",4,"ngIf"],["nzSize","large",4,"ngIf"],["nzSize","large"],[3,"nzColumn"],["nzTitle","Amount"],["nzTitle","Status"],["nz-form","",3,"formGroup",4,"ngIf"],[3,"nzColumn",4,"ngIf"],["nzTitle","Name"],["nzTitle","Account Number"],["nzTitle","Routing Number"],["nzTitle","Bank Name"],["nzTitle","Branch Name"],["nzTitle","Account Holder Name"],["nzTitle","Account Holder Country"],["nzTitle","Account Holder State"],["nzTitle","Account Holder City"],["nzTitle","Account Holder Address"],["nz-form","",3,"formGroup"],["nzRequired","","nzFor","transactionNumber"],["nz-input","","id","transactionNumber","nzPlaceHolder","Transaction Number"],["nzRequired","","nzFor","description"],["nz-input","","id","description","type","text","nzSize","large","nzPlaceHolder","Description"]],template:function(a,o){if(1&a){const r=t.RV6();t.j41(0,"nz-page-header",2)(1,"nz-page-header-extra")(2,"nz-space")(3,"button",3),t.EFF(4),t.nI1(5,"translate"),t.nrm(6,"i",4),t.k0s(),t.j41(7,"nz-dropdown-menu",null,0)(9,"ul",5)(10,"li",6),t.bIt("click",function(){return t.eBV(r),t.Njj(o.changeStatus(o.payoutSessionStatus.Pending))}),t.EFF(11,"Pending"),t.k0s(),t.j41(12,"li",6),t.bIt("click",function(){return t.eBV(r),t.Njj(o.changeStatus(o.payoutSessionStatus.Paid))}),t.EFF(13,"Paid"),t.k0s(),t.j41(14,"li",6),t.bIt("click",function(){return t.eBV(r),t.Njj(o.changeStatus(o.payoutSessionStatus.Cancelled))}),t.EFF(15,"Canceled"),t.k0s(),t.j41(16,"li",6),t.bIt("click",function(){return t.eBV(r),t.Njj(o.changeStatus(o.payoutSessionStatus.Failed))}),t.EFF(17,"Failed"),t.k0s()()()()(),t.DNE(18,Dt,11,16,"nz-page-header-content",7),t.nI1(19,"async"),t.k0s(),t.j41(20,"nz-modal",8),t.mxI("nzVisibleChange",function(S){return t.eBV(r),t.DH7(o.payoutDialogVisible,S)||(o.payoutDialogVisible=S),t.Njj(S)}),t.bIt("nzOnCancel",function(){return t.eBV(r),t.Njj(o.payoutDialogVisible=!1)})("nzOnOk",function(){return t.eBV(r),t.Njj(o.saveManualPayout(o.payoutDialogData.id))}),t.DNE(21,$t,2,1,"div",9)(22,Bt,3,2,"div",10),t.k0s()}if(2&a){let r;const c=t.sdS(8);t.Mz_("nzTitle","Payout Session #",o.id,""),t.Y8G("nzGhost",!1),t.R7$(3),t.Y8G("nzDropdownMenu",c),t.R7$(),t.SpI(" ",t.bMT(5,9,"driver.profile.changeStatus")," "),t.R7$(14),t.Y8G("ngIf",null==(r=t.bMT(19,11,o.query))||null==r.data?null:r.data.taxiPayoutSession),t.R7$(2),t.R50("nzVisible",o.payoutDialogVisible),t.Y8G("nzOkDisabled",(null==o.payoutDialogData?null:o.payoutDialogData.status)==o.transactionStatus.Done)("nzOkLoading",o.payoutDialogLoading)}},dependencies:[l.Sq,l.bT,y.qT,y.cb,y.j4,u.CP,u.SO,u._4,u.IL,u.aj,u.kt,A.Sy,_.jS,_.CU,p.j3,p.wQ,p.h4,d.aO,f.c,m.p,z.Dn,h.Uq,h.e,T.CA,T.Ls,T.Mo,T.zS,V.s,v.WB,v.k9,v.zR,v.ov,v.vy,ut.a,x.IV,N.xA,N.gr,ct.PM,pt.cK,dt.LH,X.U5,X.Dq,$.F2,$.A9,$.hk,_t.Di,P.Wk,l.Jj,l.oe,E.D9],encapsulation:2})}return e})(),resolve:{payoutSession:(e,i)=>(0,t.WQX)(g.q7I).fetch({id:e.params.id}),transactions:(e,i)=>{const n=(0,t.WQX)(g.S6g),a=(0,t.WQX)(C.a),{paging:o}=a.deserializeQueryParams(e.queryParams);return n.fetch({id:e.params.id,paging:o})}},runGuardsAndResolvers:"paramsOrQueryParamsChange"}];let Ot=(()=>{class e{static \u0275fac=function(a){return new(a||e)};static \u0275mod=t.$C({type:e});static \u0275inj=t.G2t({imports:[P.iI.forChild(wt),P.iI]})}return e})();var Ut=s(5885);let Qt=(()=>{class e{static \u0275fac=function(a){return new(a||e)};static \u0275mod=t.$C({type:e});static \u0275inj=t.G2t({imports:[Ut.G,Ot]})}return e})()}}]);