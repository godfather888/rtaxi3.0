"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[254],{6254:(V,R,r)=>{r.r(R),r.d(R,{RewardsModule:()=>Z});var v=r(7624),b=r(6807),j=r(2067),G=r(6354),e=r(1360),p=r(2209),F=r(8434),o=r(3617),a=r(3359),u=r(513),l=r(6389),d=r(5930),m=r(1951),s=r(3062),c=r(8018);function h(n,y){if(1&n&&(e.j41(0,"tr",8)(1,"td")(2,"div")(3,"div",9),e.EFF(4),e.k0s(),e.j41(5,"div",10),e.EFF(6),e.nI1(7,"date"),e.nI1(8,"date"),e.k0s()()(),e.j41(9,"td"),e.EFF(10),e.k0s()()),2&n){const t=y.$implicit;e.Y8G("routerLink","view/"+t.id),e.R7$(4),e.SpI(" ",t.title," "),e.R7$(2),e.Lme(" ",e.i5U(7,5,t.startDate,"mediumDate")," - ",e.i5U(8,8,t.endDate,"mediumDate")," "),e.R7$(4),e.JRh(t.beneficiary)}}function M(n,y){if(1&n){const t=e.RV6();e.j41(0,"nz-table",6,0),e.bIt("nzQueryParams",function(f){e.eBV(t);const g=e.XpG();return e.Njj(g.tableService.onTableQueryParamsChange(f))}),e.j41(2,"thead")(3,"tr")(4,"th"),e.EFF(5),e.nI1(6,"translate"),e.k0s(),e.j41(7,"th"),e.EFF(8),e.nI1(9,"translate"),e.k0s()()(),e.j41(10,"tbody"),e.DNE(11,h,11,11,"tr",7),e.k0s()()}if(2&n){const t=y.ngIf,i=e.sdS(1);e.Y8G("nzFrontPagination",!1)("nzData",t.nodes)("nzTotal",t.totalCount),e.R7$(5),e.JRh(e.bMT(6,6,"profile.title")),e.R7$(3),e.JRh(e.bMT(9,8,"profile.beneficiary")),e.R7$(3),e.Y8G("ngForOf",i.data)}}let N=(()=>{class n{route;tableService;tagColor;query;constructor(t,i,f){this.route=t,this.tableService=i,this.tagColor=f}ngOnInit(){this.query=this.route.data.pipe((0,G.T)(t=>t.rewards))}static \u0275fac=function(i){return new(i||n)(e.rXU(p.nX),e.rXU(b.a),e.rXU(j.t))};static \u0275cmp=e.VBU({type:n,selectors:[["app-reward-list"]],standalone:!1,decls:11,vars:10,consts:[["table",""],["nzBackIcon","","nzSubtitle","List of all the reward & referral rules",3,"nzGhost","nzTitle"],["nz-button","","nzType","primary","routerLink","new"],["nz-icon","","nzType","plus"],["nzType","warning","nzMessage","Warning","nzDescription","This feature is still under development and the application side is yet to be integrated. Full roll-out of this feature is planned for coming weeks.","nzShowIcon","",1,"mb-2"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzQueryParams","nzFrontPagination","nzData","nzTotal"],["class","group cursor-pointer",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","cursor-pointer",3,"routerLink"],[1,"text-sm","text-neutral-700","group-hover:text-neutral-900"],[1,"text-sm","text-neutral-400","group-hover:text-neutral-700"]],template:function(i,f){if(1&i&&(e.j41(0,"nz-page-header",1),e.nI1(1,"translate"),e.j41(2,"nz-page-header-extra")(3,"button",2),e.nrm(4,"i",3),e.EFF(5),e.nI1(6,"translate"),e.k0s()(),e.j41(7,"nz-page-header-content"),e.nrm(8,"nz-alert",4),e.DNE(9,M,12,10,"nz-table",5),e.nI1(10,"async"),e.k0s()()),2&i){let g;e.Y8G("nzGhost",!1)("nzTitle",e.bMT(1,4,"menu.marketing.rewards")),e.R7$(5),e.JRh(e.bMT(6,6,"profile.add")),e.R7$(4),e.Y8G("ngIf",null==(g=e.bMT(10,8,f.query))||null==g.data?null:g.data.rewards)}},dependencies:[v.Wk,F.Sq,F.bT,o.Y,a.CP,a.SO,a._4,a.IL,a.aj,a.kt,u.aO,l.c,d.p,m.Dn,s.WB,s.zR,s.ov,F.Jj,F.vh,c.D9],encapsulation:2})}return n})();var T=r(3241);let D=(()=>{class n{paging;gql;constructor(t,i){this.paging=t,this.gql=i}resolve(t,i){const f=this.paging.deserializeQueryParams(t.queryParams);return this.gql.fetch(f)}static \u0275fac=function(i){return new(i||n)(e.KVO(b.a),e.KVO(T.s8g))};static \u0275prov=e.jDH({token:n,factory:n.\u0275fac})}return n})();var U=r(467),z=r(9417),Q=r(6195),L=r(4843),J=r(7094),A=r(712),B=r(1011),w=r(7529),C=r(8927),$=r(1997),X=r(9448),E=r(8960),x=r(2047);function Y(n,y){if(1&n&&e.nrm(0,"nz-option",34),2&n){const t=y.$implicit;e.Y8G("nzLabel",t.label)("nzValue",t.value)}}let P=(()=>{class n{route;message;fb;routerHelper;createGQL;updateGQL;form;currencies=Q.P;constructor(t,i,f,g,I,S){this.route=t,this.message=i,this.fb=f,this.routerHelper=g,this.createGQL=I,this.updateGQL=S}ngOnInit(){this.route.data.subscribe(t=>{null!=t.reward&&(t.reward.data.reward.dates=[t.reward.data.reward.startDate,t.reward.data.reward.endDate],this.form.patchValue(t.reward.data.reward))}),this.form=this.fb.group({id:[null],title:[null,z.k0.required],dates:[null,z.k0.required],appType:[null,z.k0.required],beneficiary:[null,z.k0.required],event:[null,z.k0.required],creditGift:[0,z.k0.required],tripFeePercentGift:[0,z.k0.required],creditCurrency:[null],conditionTripCountsLessThan:[null],conditionUserNumberFirstDigits:[null]})}onSubmit(){var t=this;return(0,U.A)(function*(){const{id:i,dates:f,conditionUserNumber:g,...I}=t.form.value,k={...I,startDate:f[0].getTime(),endDate:f[1].getTime(),conditionUserNumberFirstDigits:null!=g&&g.length>0?g.split(","):null};try{null==i?yield(0,L._)(t.createGQL.mutate({input:k})):yield(0,L._)(t.updateGQL.mutate({id:i,input:k})),t.routerHelper.goToParent(t.route)}catch(ee){t.message.error(ee.message)}})()}static \u0275fac=function(i){return new(i||n)(e.rXU(p.nX),e.rXU(J.xh),e.rXU(z.ze),e.rXU(A.T),e.rXU(T.omp),e.rXU(T.PFz))};static \u0275cmp=e.VBU({type:n,selectors:[["app-reward-view"]],standalone:!1,decls:76,vars:35,consts:[["nzBackIcon","","nzSubtitle","Definitions of rewarding rule.",3,"nzGhost","nzTitle"],["nz-form","","nzLayout","vertical",3,"ngSubmit","formGroup"],["formControlName","id","type","hidden","hidden",""],[1,"lg:grid","lg:grid-cols-4","lg:gap-2"],["nzRequired","","nzFor","title"],["nz-input","","formControlName","title","id","title"],["nzRequired","","nzFor","dates"],["id","dates","formControlName","dates",1,"w-full"],["nzRequired","","nzFor","appType"],["formControlName","appType","id","appTyoe"],["nzLabel","Driver","nzValue","Driver"],["nzLabel","Rider","nzValue","Rider"],["nzRequired","","nzFor","beneficiary"],["formControlName","beneficiary","id","beneficiary"],["nzLabel","Self","nzValue","Self"],["nzLabel","Referrer","nzValue","Referrer"],["nzRequired","","nzFor","event"],["formControlName","event","id","event"],["nzLabel","Register","nzValue","Register"],["nzLabel","Service Completed","nzValue","ServiceCompleted"],["nzRequired","","nzFor","creditGift"],["formControlName","creditGift","id","creditGift"],["nzRequired","","nzFor","tripFeePercentGift"],["formControlName","tripFeePercentGift","id","tripFeePercentGift"],["nzRequired","","nzFor","creditCurrency"],["formControlName","creditCurrency","id","creditCurrency","nzShowSearch",""],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzText","Conditions","nzOrientation","left"],[1,"lg:grid","lg:grid-cols-2","lg:gap-2"],["nzRequired","","nzFor","conditionTripCountsLessThan"],["formControlName","conditionTripCountsLessThan","id","conditionTripCountsLessThan"],["nzFor","conditionUserNumberFirstDigits"],["nz-input","","formControlName","conditionUserNumberFirstDigits","id","conditionUserNumberFirstDigits"],["nz-button","","nzType","primary","type","submit",1,"float-right",3,"disabled"],[3,"nzLabel","nzValue"]],template:function(i,f){1&i&&(e.j41(0,"nz-page-header",0)(1,"nz-page-header-content")(2,"form",1),e.bIt("ngSubmit",function(){return f.onSubmit()}),e.nrm(3,"input",2),e.j41(4,"div",3)(5,"nz-form-item")(6,"nz-form-label",4),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"nz-form-control"),e.nrm(10,"input",5),e.k0s()(),e.j41(11,"nz-form-item")(12,"nz-form-label",6),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"nz-form-control"),e.nrm(16,"nz-range-picker",7),e.k0s()(),e.j41(17,"nz-form-item")(18,"nz-form-label",8),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"nz-form-control")(22,"nz-select",9),e.nrm(23,"nz-option",10)(24,"nz-option",11),e.k0s()()(),e.j41(25,"nz-form-item")(26,"nz-form-label",12),e.EFF(27),e.nI1(28,"translate"),e.k0s(),e.j41(29,"nz-form-control")(30,"nz-select",13),e.nrm(31,"nz-option",14)(32,"nz-option",15),e.k0s()()(),e.j41(33,"nz-form-item")(34,"nz-form-label",16),e.EFF(35,"Event"),e.k0s(),e.j41(36,"nz-form-control")(37,"nz-select",17),e.nrm(38,"nz-option",18)(39,"nz-option",19),e.k0s()()(),e.j41(40,"nz-form-item")(41,"nz-form-label",20),e.EFF(42),e.nI1(43,"translate"),e.k0s(),e.j41(44,"nz-form-control"),e.nrm(45,"nz-input-number",21),e.k0s()(),e.j41(46,"nz-form-item")(47,"nz-form-label",22),e.EFF(48),e.nI1(49,"translate"),e.k0s(),e.j41(50,"nz-form-control"),e.nrm(51,"nz-input-number",23),e.k0s()(),e.j41(52,"nz-form-item")(53,"nz-form-label",24),e.EFF(54),e.nI1(55,"translate"),e.k0s(),e.j41(56,"nz-form-control")(57,"nz-select",25),e.DNE(58,Y,1,2,"nz-option",26),e.k0s()()()(),e.nrm(59,"nz-divider",27),e.j41(60,"div",28)(61,"nz-form-item")(62,"nz-form-label",29),e.EFF(63),e.nI1(64,"translate"),e.k0s(),e.j41(65,"nz-form-control"),e.nrm(66,"nz-input-number",30),e.k0s()(),e.j41(67,"nz-form-item")(68,"nz-form-label",31),e.EFF(69),e.nI1(70,"translate"),e.k0s(),e.j41(71,"nz-form-control"),e.nrm(72,"input",32),e.k0s()()(),e.j41(73,"button",33),e.EFF(74),e.nI1(75,"translate"),e.k0s()()()()),2&i&&(e.Y8G("nzGhost",!1)("nzTitle",null==f.form.value.id?"New reward rule":"Edit reward rule #"+f.form.value.id),e.R7$(2),e.Y8G("formGroup",f.form),e.R7$(5),e.JRh(e.bMT(8,15,"profile.title")),e.R7$(6),e.JRh(e.bMT(14,17,"profile.availabilityTime")),e.R7$(6),e.JRh(e.bMT(20,19,"profile.appType")),e.R7$(8),e.JRh(e.bMT(28,21,"profile.beneficiary")),e.R7$(15),e.JRh(e.bMT(43,23,"profile.creditGift")),e.R7$(6),e.SpI("",e.bMT(49,25,"profile.tripFeePercentGift")," "),e.R7$(6),e.JRh(e.bMT(55,27,"profile.creditCurrency")),e.R7$(4),e.Y8G("ngForOf",f.currencies),e.R7$(5),e.JRh(e.bMT(64,29,"profile.conditionTripCountsLessThan")),e.R7$(6),e.JRh(e.bMT(70,31,"profile.conditionUserNumberFirstDigits")),e.R7$(4),e.Y8G("disabled",f.form.invalid),e.R7$(),e.JRh(e.bMT(75,33,"profile.submit")))},dependencies:[F.Sq,z.qT,z.me,z.BC,z.cb,z.j4,z.JD,B.Sy,u.aO,l.c,d.p,w.Uq,w.e,C.CA,C.Ls,C.Mo,C.zS,$.ld,$.WI,X.j,E.SN,E.vw,s.WB,s.zR,x.F,c.D9],styles:["nz-input-number[_ngcontent-%COMP%]{width:100%}"]})}return n})(),O=(()=>{class n{gql;constructor(t){this.gql=t}resolve(t,i){return this.gql.fetch({id:t.params.id})}static \u0275fac=function(i){return new(i||n)(e.KVO(T.X9i))};static \u0275prov=e.jDH({token:n,factory:n.\u0275fac})}return n})();const H=[{path:"",component:N,resolve:{rewards:D},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"view/:id",component:P,resolve:{reward:O}},{path:"new",component:P}];let K=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.$C({type:n});static \u0275inj=e.G2t({providers:[D,O],imports:[v.iI.forChild(H),v.iI]})}return n})();var W=r(5885);let Z=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.$C({type:n});static \u0275inj=e.G2t({imports:[K,W.G]})}return n})()},6807:(V,R,r)=>{r.d(R,{a:()=>j});var v=r(1360),b=r(2209);let j=(()=>{class p{router;route;constructor(o,a){this.router=o,this.route=a}serializeQueryParams(o,a){const u={};if(u.pageIndex=o.pageIndex,u.pageSize=o.pageSize,null!=o.filter){const l=o.filter.filter(d=>null!=d.value&&d.value.length>0).map(d=>`${d.key}|${Array.isArray(d.value)?"in":"eq"}|${Array.isArray(d.value)?d.value.join("-"):d.value}`);null!=a.filter&&l.push(...a.filter.split(",")),u.filter=l.length>0?l.join(","):void 0}if(null!=o.sort&&o.sort.length>0){const l=o.sort.filter(d=>null!=d.value).map(d=>`${d.key}|${"ascend"==d.value?"ASC":"DESC"}`);null!=a.sort&&l.push(...a.sort.split(",")),u.sort=l.length>0?l.join(","):void 0}return u}onTableQueryParamsChange(o){const a=this.serializeQueryParams(o,this.route.snapshot.queryParams);this.router.navigate([],{relativeTo:this.route,queryParams:a,queryParamsHandling:"merge"})}filterText(o,a){const l=this.deserializeQueryParams(this.route).filter??{};l[o]=null!=a?{like:a}:{};const d=Object.keys(l).map(s=>{if(Object.keys(l[s]).length<1)return null;const c=Object.keys(l[s])[0];return`${s}|${c}|${"in"==c?l[s][c].join("-"):l[s][c]}`}).filter(s=>null!=s),m=d.length>0?d.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:m},queryParamsHandling:"merge"})}filterRange(o,a){const l=this.deserializeQueryParams(this.route).filter??{};l[o]=null!=a?{between:a}:{};const d=Object.keys(l).map(s=>{if(Object.keys(l[s]).length<1)return null;const c=Object.keys(l[s])[0];return`${s}|${c}|${"in"==c||"between"==c?l[s][c].join("-"):l[s][c]}`}).filter(s=>null!=s),m=d.length>0?d.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:m},queryParamsHandling:"merge"})}resetFilter(o,a){this.filterText(o,void 0),a.value=""}downloadURI(o,a){const u=document.createElement("a");u.download=a,u.href=o,u.target="_blank",document.body.appendChild(u),u.click(),document.body.removeChild(u)}deserializeQueryParams(o){const a=o.sort?o.sort.split(",").map(m=>({field:m.split("|")[0],direction:m.split("|")[1]})):[],u={};null!=o.filter&&o.filter.split(",").forEach(m=>{const s={},c=m.split("|")[1];if("in"==c){const h=m.split("|")[2].split("-");s[c]=h}else if("between"==c){const h=m.split("|")[2].split("-");s[c]={lower:h[0],upper:h[1]}}else s[c]=m.split("|")[2];u[m.split("|")[0]]=s});const l=null!=o.pageIndex?parseInt(o.pageIndex):1,d=null!=o.pageSize?parseInt(o.pageSize):10;return{sorting:a.length>0?a:void 0,paging:{offset:(l-1)*d,limit:d},filter:null!=u&&Object.keys(u).length>0?u:void 0}}static \u0275fac=function(a){return new(a||p)(v.KVO(b.Ix),v.KVO(b.nX))};static \u0275prov=v.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()}}]);