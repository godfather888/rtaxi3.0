"use strict";(self.webpackChunkadmin_panel=self.webpackChunkadmin_panel||[]).push([[687],{2068:(D,R,i)=>{i.r(R),i.d(R,{ManagementRegionModule:()=>_});var f=i(8434),b=i(7624),j=i(2067),M=i(6354),C=i(6807),n=i(1360),T=i(2209),r=i(3359),c=i(513),d=i(6389),l=i(5930),g=i(1951),m=i(5699),s=i(3062),p=i(8018);function h(e,v){if(1&e&&(n.j41(0,"tr",7)(1,"td"),n.EFF(2),n.k0s(),n.j41(3,"td"),n.EFF(4),n.k0s(),n.j41(5,"td")(6,"nz-tag",8),n.EFF(7),n.nI1(8,"translate"),n.nI1(9,"translate"),n.k0s()()()),2&e){const t=v.$implicit,o=n.XpG(2);n.Y8G("routerLink","view/"+t.id),n.R7$(2),n.JRh(t.name),n.R7$(2),n.JRh(t.currency),n.R7$(2),n.Y8G("nzColor",o.tagColor.boolean(t.enabled))("nzBordered",!1),n.R7$(),n.JRh(t.enabled?n.bMT(8,6,"profile.enabled"):n.bMT(9,8,"profile.disabled"))}}function x(e,v){if(1&e){const t=n.RV6();n.j41(0,"nz-table",5,0),n.bIt("nzQueryParams",function(a){n.eBV(t);const u=n.XpG();return n.Njj(u.tableService.onTableQueryParamsChange(a))}),n.j41(2,"thead")(3,"tr")(4,"th"),n.EFF(5),n.nI1(6,"translate"),n.k0s(),n.j41(7,"th"),n.EFF(8),n.nI1(9,"translate"),n.k0s(),n.j41(10,"th"),n.EFF(11),n.nI1(12,"translate"),n.k0s()()(),n.j41(13,"tbody"),n.DNE(14,h,10,10,"tr",6),n.k0s()()}if(2&e){const t=v.ngIf,o=n.sdS(1);n.Y8G("nzFrontPagination",!1)("nzData",t.nodes)("nzTotal",t.totalCount),n.R7$(5),n.JRh(n.bMT(6,7,"profile.name")),n.R7$(3),n.JRh(n.bMT(9,9,"profile.currency")),n.R7$(3),n.JRh(n.bMT(12,11,"profile.status")),n.R7$(3),n.Y8G("ngForOf",o.data)}}let B=(()=>{class e{route;tableService;router;tagColor;query;constructor(t,o,a,u){this.route=t,this.tableService=o,this.router=a,this.tagColor=u}ngOnInit(){this.query=this.route.data.pipe((0,M.T)(t=>t.regions))}static \u0275fac=function(o){return new(o||e)(n.rXU(T.nX),n.rXU(C.a),n.rXU(T.Ix),n.rXU(j.t))};static \u0275cmp=n.VBU({type:e,selectors:[["app-region-list"]],standalone:!1,decls:9,vars:7,consts:[["ajaxTable",""],["nzBackIcon","","nzTitle","Regions","nzSubtitle","List of all the regions app operates within",3,"nzGhost"],["nz-button","","nzType","primary","routerLink","new"],["nz-icon","","nzType","plus"],["nzShowSizeChanger","","nzBordered","",3,"nzFrontPagination","nzData","nzTotal","nzQueryParams",4,"ngIf"],["nzShowSizeChanger","","nzBordered","",3,"nzQueryParams","nzFrontPagination","nzData","nzTotal"],["class","group cursor-pointer",3,"routerLink",4,"ngFor","ngForOf"],[1,"group","cursor-pointer",3,"routerLink"],[3,"nzColor","nzBordered"]],template:function(o,a){if(1&o&&(n.j41(0,"nz-page-header",1)(1,"nz-page-header-extra")(2,"button",2),n.nrm(3,"i",3),n.EFF(4),n.nI1(5,"translate"),n.k0s()(),n.j41(6,"nz-page-header-content"),n.DNE(7,x,15,13,"nz-table",4),n.nI1(8,"async"),n.k0s()()),2&o){let u;n.Y8G("nzGhost",!1),n.R7$(4),n.JRh(n.bMT(5,3,"profile.add")),n.R7$(3),n.Y8G("ngIf",null==(u=n.bMT(8,5,a.query))||null==u.data?null:u.data.regions)}},dependencies:[f.Sq,f.bT,b.Wk,r.CP,r.SO,r._4,r.IL,r.aj,r.kt,c.aO,d.c,l.p,g.Dn,m.s,s.WB,s.zR,s.ov,f.Jj,p.D9],encapsulation:2})}return e})();var F=i(3241);let V=(()=>{class e{paging;gql;constructor(t,o){this.paging=t,this.gql=o}resolve(t,o){const a=this.paging.deserializeQueryParams(t.queryParams);return this.gql.fetch(a)}static \u0275fac=function(o){return new(o||e)(n.KVO(C.a),n.KVO(F.Rp1))};static \u0275prov=n.jDH({token:e,factory:e.\u0275fac})}return e})();var Q=i(467),z=i(9417),I=i(3350),S=i(4843),k=i(6195),N=i(7094),X=i(1011),E=i(7529),G=i(8927),$=i(1997),Y=i(7481),L=i(7685);function A(e,v){if(1&e){const t=n.RV6();n.j41(0,"button",18),n.bIt("click",function(){n.eBV(t);const a=n.XpG(2);return n.Njj(a.clearMap())}),n.EFF(1,"Clear Map"),n.k0s()}if(2&e){const t=n.XpG(2);n.Y8G("disabled",0===t.polygons.length)}}function U(e,v){if(1&e&&(n.j41(0,"div"),n.DNE(1,A,2,1,"button",17),n.k0s()),2&e){const t=n.XpG();n.R7$(),n.Y8G("ngIf",null!==t.form.value.id)}}function J(e,v){if(1&e){const t=n.RV6();n.j41(0,"button",19),n.bIt("click",function(){n.eBV(t);const a=n.XpG();return n.Njj(a.onSubmit())}),n.EFF(1),n.nI1(2,"translate"),n.k0s()}if(2&e){const t=n.XpG();n.Y8G("disabled",t.form.invalid||0===t.polygons.length),n.R7$(),n.JRh(n.bMT(2,2,"profile.saveChanges"))}}function K(e,v){if(1&e&&n.nrm(0,"nz-option",20),2&e){const t=v.$implicit;n.Y8G("nzLabel",t.label)("nzValue",t.value)}}let P=(()=>{class e{route;router;fb;createGQL;updateGQL;msg;form;map;center={lat:24,lng:12};drawingManager;currencies=k.P;polygons=[];constructor(t,o,a,u,y,O){this.route=t,this.router=o,this.fb=a,this.createGQL=u,this.updateGQL=y,this.msg=O,this.form=this.fb.group({id:[null],name:[null,z.k0.required],currency:[null,z.k0.required],enabled:[!0,z.k0.required],location:[null]})}ngAfterViewInit(){this.initializeDrawingManager()}initializeDrawingManager(){this.route.data.subscribe(t=>{if(null!=t.region){const a=t.region.data.region;if(null!=a&&(this.form.patchValue(a),this.polygons=a.location?.map(u=>{const y=new google.maps.Polygon({paths:u});return y.setMap(this.map.googleMap),y})??[],null!=a.location)){const u=new google.maps.LatLngBounds;for(const y of a.location)for(const O of y)u.extend(O);this.map.fitBounds(u)}}}),this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!0,map:this.map?.googleMap,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]}}),google.maps.event.addListener(this.drawingManager,"overlaycomplete",t=>{if(t.type===google.maps.drawing.OverlayType.POLYGON){const o=t.overlay;this.polygons.push(o);const a=o.getPath().getArray().map(u=>({lat:u.lat(),lng:u.lng()}));a.push(a[0]),this.form.patchValue(null==this.form.value.location?{location:[a]}:{location:[...this.form.value.location,a]})}})}onSubmit(){var t=this;return(0,Q.A)(function*(){try{const{id:o,location:a,...u}=t.form.value;console.log(a),null==o?yield(0,S._)(t.createGQL.mutate({input:{...u,location:a}})):yield(0,S._)(t.updateGQL.mutate({id:o,update:{...u,location:a}})),t.router.navigate(["management/regions"],{relativeTo:t.route.root})}catch(o){t.msg.error(o.message)}})()}clearMap(){for(const t of this.polygons)t.setMap(null);this.polygons=[],this.form.value.location=[],this.form.patchValue({location:[]})}static \u0275fac=function(o){return new(o||e)(n.rXU(T.nX),n.rXU(T.Ix),n.rXU(z.ze),n.rXU(F.pdo),n.rXU(F.QnF),n.rXU(N.xh))};static \u0275cmp=n.VBU({type:e,selectors:[["app-region-view"]],viewQuery:function(o,a){if(1&o&&n.GBs(I.u6,5),2&o){let u;n.mGM(u=n.lsd())&&(a.map=u.first)}},standalone:!1,decls:32,vars:6,consts:[["poly",""],["nzBackIcon","","nzTitle","New Region","nzSubtitle","Pramaters of region app is operating within.",3,"nzGhost"],[4,"nzSpaceItem"],["nz-button","","nzType","primary",3,"disabled","click",4,"nzSpaceItem"],["nz-form","",3,"ngSubmit","formGroup"],["formControlName","id","type","hidden","hidden",""],["nzRequired","","nzFor","name"],["nzErrorTip","The input is not valid name"],["nz-input","","formControlName","name","id","name"],["nzRequired","","nzFor","currency"],["formControlName","currency","id","currency","nzShowSearch",""],[3,"nzLabel","nzValue",4,"ngFor","ngForOf"],["nzFor","enabled","nzRequired",""],["formControlName","enabled","id","enabled"],["type","hidden","hidden","","formControlName","location"],["height","400px","width","100%",3,"center","zoom"],[3,"paths"],["nz-button","",3,"disabled","click",4,"ngIf"],["nz-button","",3,"click","disabled"],["nz-button","","nzType","primary",3,"click","disabled"],[3,"nzLabel","nzValue"]],template:function(o,a){if(1&o){const u=n.RV6();n.j41(0,"nz-page-header",1)(1,"nz-page-header-extra")(2,"nz-space"),n.DNE(3,U,2,1,"div",2)(4,J,3,4,"button",3),n.k0s()(),n.j41(5,"nz-page-header-content")(6,"form",4),n.bIt("ngSubmit",function(){return n.eBV(u),n.Njj(a.onSubmit())}),n.nrm(7,"input",5),n.j41(8,"nz-form-item")(9,"nz-form-label",6),n.EFF(10,"Name"),n.k0s(),n.j41(11,"nz-form-control",7),n.nrm(12,"input",8),n.k0s()(),n.j41(13,"nz-form-item")(14,"nz-form-label",9),n.EFF(15,"Currency"),n.k0s(),n.j41(16,"nz-form-control")(17,"nz-select",10),n.DNE(18,K,1,2,"nz-option",11),n.k0s()()(),n.j41(19,"nz-form-item")(20,"nz-form-label",12),n.EFF(21,"Is Enabled"),n.k0s(),n.j41(22,"nz-form-control"),n.nrm(23,"nz-switch",13),n.k0s()(),n.j41(24,"nz-form-item")(25,"nz-form-label",12),n.EFF(26,"Geofence"),n.k0s(),n.j41(27,"nz-form-control"),n.nrm(28,"input",14),n.j41(29,"google-map",15),n.nrm(30,"map-polygon",16,0),n.k0s()()()()()()}2&o&&(n.Y8G("nzGhost",!1),n.R7$(6),n.Y8G("formGroup",a.form),n.R7$(12),n.Y8G("ngForOf",a.currencies),n.R7$(11),n.Y8G("center",a.center)("zoom",4),n.R7$(),n.Y8G("paths",null==a.form.value?null:a.form.value.location))},dependencies:[f.Sq,f.bT,z.qT,z.me,z.BC,z.cb,z.j4,z.JD,X.Sy,c.aO,d.c,l.p,E.Uq,E.e,G.CA,G.Ls,G.Mo,G.zS,$.ld,$.WI,s.WB,s.zR,s.ov,I.u6,I.tc,Y.u,L.U5,L.Dq,p.D9],encapsulation:2})}return e})(),w=(()=>{class e{gql;constructor(t){this.gql=t}resolve(t,o){return this.gql.fetch({id:t.params.id})}static \u0275fac=function(o){return new(o||e)(n.KVO(F.CgO))};static \u0275prov=n.jDH({token:e,factory:e.\u0275fac})}return e})();const H=[{path:"",component:B,resolve:{regions:V},runGuardsAndResolvers:"paramsOrQueryParamsChange"},{path:"view/:id",component:P,resolve:{region:w}},{path:"new",component:P}];let W=(()=>{class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=n.$C({type:e});static \u0275inj=n.G2t({providers:[V,w],imports:[b.iI.forChild(H),b.iI]})}return e})();var Z=i(5885);let _=(()=>{class e{static \u0275fac=function(o){return new(o||e)};static \u0275mod=n.$C({type:e});static \u0275inj=n.G2t({providers:[j.t],imports:[f.MD,W,Z.G]})}return e})()},6807:(D,R,i)=>{i.d(R,{a:()=>j});var f=i(1360),b=i(2209);let j=(()=>{class n{router;route;constructor(r,c){this.router=r,this.route=c}serializeQueryParams(r,c){const d={};if(d.pageIndex=r.pageIndex,d.pageSize=r.pageSize,null!=r.filter){const l=r.filter.filter(g=>null!=g.value&&g.value.length>0).map(g=>`${g.key}|${Array.isArray(g.value)?"in":"eq"}|${Array.isArray(g.value)?g.value.join("-"):g.value}`);null!=c.filter&&l.push(...c.filter.split(",")),d.filter=l.length>0?l.join(","):void 0}if(null!=r.sort&&r.sort.length>0){const l=r.sort.filter(g=>null!=g.value).map(g=>`${g.key}|${"ascend"==g.value?"ASC":"DESC"}`);null!=c.sort&&l.push(...c.sort.split(",")),d.sort=l.length>0?l.join(","):void 0}return d}onTableQueryParamsChange(r){const c=this.serializeQueryParams(r,this.route.snapshot.queryParams);this.router.navigate([],{relativeTo:this.route,queryParams:c,queryParamsHandling:"merge"})}filterText(r,c){const l=this.deserializeQueryParams(this.route).filter??{};l[r]=null!=c?{like:c}:{};const g=Object.keys(l).map(s=>{if(Object.keys(l[s]).length<1)return null;const p=Object.keys(l[s])[0];return`${s}|${p}|${"in"==p?l[s][p].join("-"):l[s][p]}`}).filter(s=>null!=s),m=g.length>0?g.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:m},queryParamsHandling:"merge"})}filterRange(r,c){const l=this.deserializeQueryParams(this.route).filter??{};l[r]=null!=c?{between:c}:{};const g=Object.keys(l).map(s=>{if(Object.keys(l[s]).length<1)return null;const p=Object.keys(l[s])[0];return`${s}|${p}|${"in"==p||"between"==p?l[s][p].join("-"):l[s][p]}`}).filter(s=>null!=s),m=g.length>0?g.join(","):void 0;this.router.navigate([],{relativeTo:this.route,queryParams:{filter:m},queryParamsHandling:"merge"})}resetFilter(r,c){this.filterText(r,void 0),c.value=""}downloadURI(r,c){const d=document.createElement("a");d.download=c,d.href=r,d.target="_blank",document.body.appendChild(d),d.click(),document.body.removeChild(d)}deserializeQueryParams(r){const c=r.sort?r.sort.split(",").map(m=>({field:m.split("|")[0],direction:m.split("|")[1]})):[],d={};null!=r.filter&&r.filter.split(",").forEach(m=>{const s={},p=m.split("|")[1];if("in"==p){const h=m.split("|")[2].split("-");s[p]=h}else if("between"==p){const h=m.split("|")[2].split("-");s[p]={lower:h[0],upper:h[1]}}else s[p]=m.split("|")[2];d[m.split("|")[0]]=s});const l=null!=r.pageIndex?parseInt(r.pageIndex):1,g=null!=r.pageSize?parseInt(r.pageSize):10;return{sorting:c.length>0?c:void 0,paging:{offset:(l-1)*g,limit:g},filter:null!=d&&Object.keys(d).length>0?d:void 0}}static \u0275fac=function(c){return new(c||n)(f.KVO(b.Ix),f.KVO(b.nX))};static \u0275prov=f.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()}}]);